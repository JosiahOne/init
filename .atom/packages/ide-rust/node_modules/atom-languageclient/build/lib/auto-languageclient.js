"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.LanguageClientConnection = void 0;
const cp = require("child_process");
const rpc = require("vscode-jsonrpc");
const rpcNode = require("vscode-jsonrpc/node");
const path = require("path");
const convert_js_1 = require("./convert.js");
const apply_edit_adapter_1 = require("./adapters/apply-edit-adapter");
const autocomplete_adapter_1 = require("./adapters/autocomplete-adapter");
const CallHierarchyAdapter = require("./adapters/call-hierarchy-adapter");
const code_action_adapter_1 = require("./adapters/code-action-adapter");
const code_format_adapter_1 = require("./adapters/code-format-adapter");
const code_highlight_adapter_1 = require("./adapters/code-highlight-adapter");
const datatip_adapter_1 = require("./adapters/datatip-adapter");
const definition_adapter_1 = require("./adapters/definition-adapter");
const document_sync_adapter_1 = require("./adapters/document-sync-adapter");
const find_references_adapter_1 = require("./adapters/find-references-adapter");
const linter_push_v2_adapter_1 = require("./adapters/linter-push-v2-adapter");
const logging_console_adapter_1 = require("./adapters/logging-console-adapter");
const notifications_adapter_1 = require("./adapters/notifications-adapter");
const outline_view_adapter_1 = require("./adapters/outline-view-adapter");
const rename_adapter_1 = require("./adapters/rename-adapter");
const signature_help_adapter_1 = require("./adapters/signature-help-adapter");
const ShowDocumentAdapter = require("./adapters/show-document-adapter");
const Utils = require("./utils");
const languageclient_1 = require("./languageclient");
Object.defineProperty(exports, "LanguageClientConnection", { enumerable: true, get: function () { return languageclient_1.LanguageClientConnection; } });
const logger_1 = require("./logger");
const server_manager_js_1 = require("./server-manager.js");
const atom_1 = require("atom");
const path_1 = require("path");
/**
 * Public: AutoLanguageClient provides a simple way to have all the supported Atom-IDE services wired up entirely for
 * you by just subclassing it and implementing at least
 *
 * - `startServerProcess`
 * - `getGrammarScopes`
 * - `getLanguageName`
 * - `getServerName`
 */
class AutoLanguageClient {
    constructor() {
        this._isDeactivating = false;
        this._serverAdapters = new WeakMap();
        this.processStdErr = "";
        /**
         * If this is set to `true` (the default value), the servers will shut down gracefully. If it is set to `false`, the
         * servers will be killed without awaiting shutdown response.
         */
        this.shutdownGracefully = true;
        this.reportBusyWhile = (title, f) => __awaiter(this, void 0, void 0, function* () {
            if (this.busySignalService) {
                return this.busySignalService.reportBusyWhile(title, f);
            }
            else {
                return this.reportBusyWhileDefault(title, f);
            }
        });
        this.reportBusyWhileDefault = (title, f) => __awaiter(this, void 0, void 0, function* () {
            this.logger.info(`[Started] ${title}`);
            let res;
            try {
                res = yield f();
            }
            finally {
                this.logger.info(`[Finished] ${title}`);
            }
            return res;
        });
    }
    // You must implement these so we know how to deal with your language and server
    // -------------------------------------------------------------------------
    /** Return an array of the grammar scopes you handle, e.g. [ 'source.js' ] */
    getGrammarScopes() {
        throw Error("Must implement getGrammarScopes when extending AutoLanguageClient");
    }
    /** Return the name of the language you support, e.g. 'JavaScript' */
    getLanguageName() {
        throw Error("Must implement getLanguageName when extending AutoLanguageClient");
    }
    /** Return the name of your server, e.g. 'Eclipse JDT' */
    getServerName() {
        throw Error("Must implement getServerName when extending AutoLanguageClient");
    }
    /** Start your server process */
    startServerProcess(_projectPath) {
        throw Error("Must override startServerProcess to start language server process when extending AutoLanguageClient");
    }
    // You might want to override these for different behavior
    // ---------------------------------------------------------------------------
    /** (Optional) Determine whether we should start a server for a given editor if we don't have one yet */
    shouldStartForEditor(editor) {
        return this.getGrammarScopes().includes(editor.getGrammar().scopeName);
    }
    /** (Optional) Return the parameters used to initialize a client - you may want to extend capabilities */
    getInitializeParams(projectPath, lsProcess) {
        const rootUri = convert_js_1.default.pathToUri(projectPath);
        return {
            processId: lsProcess.pid !== undefined ? lsProcess.pid : null,
            rootPath: projectPath,
            rootUri,
            locale: atom.config.get("atom-i18n.locale") || "en",
            workspaceFolders: [{ uri: rootUri, name: path_1.basename(projectPath) }],
            // The capabilities supported.
            // TODO the capabilities set to false/undefined are TODO. See {ls.ServerCapabilities} for a full list.
            capabilities: {
                workspace: {
                    applyEdit: true,
                    configuration: false,
                    workspaceEdit: {
                        documentChanges: true,
                        normalizesLineEndings: false,
                        changeAnnotationSupport: undefined,
                        resourceOperations: ["create", "rename", "delete"],
                    },
                    workspaceFolders: true,
                    didChangeConfiguration: {
                        dynamicRegistration: false,
                    },
                    didChangeWatchedFiles: {
                        dynamicRegistration: false,
                    },
                    // BLOCKED: on atom/symbols-view
                    symbol: {
                        dynamicRegistration: false,
                    },
                    executeCommand: {
                        dynamicRegistration: false,
                    },
                    semanticTokens: undefined,
                    codeLens: undefined,
                    fileOperations: {
                        // BLOCKED: on tree-view not providing hooks for "before file/dir created"
                        willCreate: false,
                        // BLOCKED: on tree-view not providing hooks for "before file/dir renamed"
                        willRename: false,
                        // BLOCKED: on tree-view not providing hooks for "before file/dir deleted"
                        willDelete: false,
                    },
                },
                textDocument: {
                    synchronization: {
                        dynamicRegistration: false,
                        willSave: true,
                        willSaveWaitUntil: true,
                        didSave: true,
                    },
                    completion: {
                        dynamicRegistration: false,
                        completionItem: {
                            snippetSupport: true,
                            commitCharactersSupport: false,
                            documentationFormat: [],
                            deprecatedSupport: false,
                            preselectSupport: false,
                            tagSupport: {
                                valueSet: [],
                            },
                            insertReplaceSupport: false,
                            resolveSupport: {
                                properties: [],
                            },
                            insertTextModeSupport: {
                                valueSet: [],
                            },
                        },
                        completionItemKind: {
                            valueSet: [],
                        },
                        contextSupport: true,
                    },
                    hover: {
                        dynamicRegistration: false,
                    },
                    signatureHelp: {
                        dynamicRegistration: false,
                    },
                    declaration: undefined,
                    references: {
                        dynamicRegistration: false,
                    },
                    documentHighlight: {
                        dynamicRegistration: false,
                    },
                    documentSymbol: {
                        dynamicRegistration: false,
                        hierarchicalDocumentSymbolSupport: true,
                    },
                    formatting: {
                        dynamicRegistration: false,
                    },
                    rangeFormatting: {
                        dynamicRegistration: false,
                    },
                    onTypeFormatting: {
                        dynamicRegistration: false,
                    },
                    definition: {
                        dynamicRegistration: false,
                    },
                    codeAction: {
                        dynamicRegistration: false,
                        codeActionLiteralSupport: {
                            codeActionKind: {
                                valueSet: [""], // TODO explicitly support more?
                            },
                        },
                    },
                    codeLens: {
                        dynamicRegistration: false,
                    },
                    documentLink: {
                        dynamicRegistration: false,
                    },
                    rename: {
                        dynamicRegistration: false,
                    },
                    moniker: {
                        dynamicRegistration: false,
                    },
                    publishDiagnostics: {
                        relatedInformation: true,
                        tagSupport: {
                            // BLOCKED: on steelbrain/linter supporting ways of denoting useless code and deprecated symbols
                            valueSet: [],
                        },
                        versionSupport: false,
                        codeDescriptionSupport: true,
                        dataSupport: true,
                    },
                    callHierarchy: {
                        dynamicRegistration: false,
                    },
                    implementation: undefined,
                    typeDefinition: undefined,
                    colorProvider: undefined,
                    foldingRange: undefined,
                    selectionRange: undefined,
                    linkedEditingRange: undefined,
                    semanticTokens: undefined,
                },
                general: {
                    regularExpressions: undefined,
                    markdown: undefined,
                },
                window: {
                    workDoneProgress: false,
                    showMessage: undefined,
                    showDocument: { support: true },
                },
                experimental: {},
            },
        };
    }
    /** (Optional) Early wire-up of listeners before initialize method is sent */
    preInitialization(_connection) { }
    /** (Optional) Late wire-up of listeners after initialize method has been sent */
    postInitialization(_server) { }
    /** (Optional) Determine whether to use ipc, stdio or socket to connect to the server */
    getConnectionType() {
        return this.socket != null ? "socket" : "stdio";
    }
    /** (Optional) Return the name of your root configuration key */
    getRootConfigurationKey() {
        return "";
    }
    /** (Optional) Transform the configuration object before it is sent to the server */
    mapConfigurationObject(configuration) {
        return configuration;
    }
    // Helper methods that are useful for implementors
    // ---------------------------------------------------------------------------
    /** Gets a LanguageClientConnection for a given TextEditor */
    getConnectionForEditor(editor) {
        return __awaiter(this, void 0, void 0, function* () {
            const server = yield this._serverManager.getServer(editor);
            return server ? server.connection : null;
        });
    }
    /** Restart all active language servers for this language client in the workspace */
    restartAllServers() {
        return __awaiter(this, void 0, void 0, function* () {
            yield this._serverManager.restartAllServers();
        });
    }
    // Default implementation of the rest of the AutoLanguageClient
    // ---------------------------------------------------------------------------
    /** Activate does very little for perf reasons - hooks in via ServerManager for later 'activation' */
    activate() {
        this._disposable = new atom_1.CompositeDisposable();
        this.name = `${this.getLanguageName()} (${this.getServerName()})`;
        this.logger = this.getLogger();
        this._serverManager = new server_manager_js_1.ServerManager((p) => this.startServer(p), this.logger, (e) => this.shouldStartForEditor(e), (filepath) => this.filterChangeWatchedFiles(filepath), this.reportBusyWhile, this.getServerName(), (textEditor) => this.determineProjectPath(textEditor), this.shutdownGracefully);
        this._serverManager.startListening();
        process.on("exit", () => this.exitCleanup.bind(this));
    }
    exitCleanup() {
        this._serverManager.terminate();
    }
    /** Deactivate disposes the resources we're using */
    deactivate() {
        return __awaiter(this, void 0, void 0, function* () {
            this._isDeactivating = true;
            this._disposable.dispose();
            this._serverManager.stopListening();
            yield this._serverManager.stopAllServers();
        });
    }
    /**
     * Spawn a general language server. Use this inside the `startServerProcess` override if the language server is a
     * general executable. Also see the `spawnChildNode` method. If the name is provided as the first argument, it checks
     * `bin/platform-arch/exeName` by default, and if doesn't exists uses the exe on PATH. For example on Windows x64, by
     * passing `serve-d`, `bin/win32-x64/exeName.exe` is spawned by default.
     *
     * @param exe The `name` or `path` of the executable
     * @param args Args passed to spawn the exe. Defaults to `[]`.
     * @param options: Child process spawn options. Defaults to `{}`.
     * @param rootPath The path of the folder of the exe file. Defaults to `join("bin", `${process.platform}-${process.arch} `)`.
     * @param exeExtention The extention of the exe file. Defaults to `process.platform === "win32" ? ".exe" : ""`
     */
    spawn(exe, args = [], options = {}, rootPath = Utils.rootPathDefault, exeExtention = Utils.exeExtentionDefault) {
        this.logger.debug(`starting "${exe} ${args.join(" ")}"`);
        return cp.spawn(Utils.getExePath(exe, rootPath, exeExtention), args, options);
    }
    /**
     * Spawn a language server using Atom's Nodejs process Use this inside the `startServerProcess` override if the
     * language server is a JavaScript file. Also see the `spawn` method
     */
    spawnChildNode(args, options = {}) {
        this.logger.debug(`starting child Node "${args.join(" ")}"`);
        options.env = options.env || Object.create(process.env);
        if (options.env) {
            options.env.ELECTRON_RUN_AS_NODE = "1";
            options.env.ELECTRON_NO_ATTACH_CONSOLE = "1";
        }
        return cp.spawn(process.execPath, args, options);
    }
    /** LSP logging is only set for warnings & errors by default unless you turn on the core.debugLSP setting */
    getLogger() {
        const filter = atom.config.get("core.debugLSP")
            ? logger_1.FilteredLogger.DeveloperLevelFilter
            : logger_1.FilteredLogger.UserLevelFilter;
        return new logger_1.FilteredLogger(new logger_1.ConsoleLogger(this.name), filter);
    }
    /** Starts the server by starting the process, then initializing the language server and starting adapters */
    startServer(projectPath) {
        return __awaiter(this, void 0, void 0, function* () {
            const lsProcess = yield this.reportBusyWhile(`Starting ${this.getServerName()} for ${path.basename(projectPath)}`, () => __awaiter(this, void 0, void 0, function* () { return this.startServerProcess(projectPath); }));
            this.captureServerErrors(lsProcess, projectPath);
            const connection = new languageclient_1.LanguageClientConnection(this.createRpcConnection(lsProcess), this.logger);
            this.preInitialization(connection);
            const initializeParams = this.getInitializeParams(projectPath, lsProcess);
            const initialization = connection.initialize(initializeParams);
            this.reportBusyWhile(`${this.getServerName()} initializing for ${path.basename(projectPath)}`, () => initialization);
            const initializeResponse = yield initialization;
            const newServer = {
                projectPath,
                process: lsProcess,
                connection,
                capabilities: initializeResponse.capabilities,
                disposable: new atom_1.CompositeDisposable(),
                additionalPaths: new Set(),
            };
            this.postInitialization(newServer);
            connection.initialized();
            connection.on("close", () => {
                if (!this._isDeactivating) {
                    this._serverManager.stopServer(newServer);
                    if (!this._serverManager.hasServerReachedRestartLimit(newServer)) {
                        this.logger.debug(`Restarting language server for project '${newServer.projectPath}'`);
                        this._serverManager.startServer(projectPath);
                    }
                    else {
                        this.logger.warn(`Language server has exceeded auto-restart limit for project '${newServer.projectPath}'`);
                        atom.notifications.addError(`The ${this.name} language server has exited and exceeded the restart limit for project '${newServer.projectPath}'`);
                    }
                }
            });
            const configurationKey = this.getRootConfigurationKey();
            if (configurationKey) {
                newServer.disposable.add(atom.config.observe(configurationKey, (config) => {
                    const mappedConfig = this.mapConfigurationObject(config || {});
                    if (mappedConfig) {
                        connection.didChangeConfiguration({
                            settings: mappedConfig,
                        });
                    }
                }));
            }
            this.startExclusiveAdapters(newServer);
            return newServer;
        });
    }
    captureServerErrors(lsProcess, projectPath) {
        var _a, _b;
        lsProcess.on("error", (err) => this.onSpawnError(err));
        lsProcess.on("close", (code, signal) => this.onSpawnClose(code, signal));
        lsProcess.on("disconnect", () => this.onSpawnDisconnect());
        lsProcess.on("exit", (code, signal) => this.onSpawnExit(code, signal));
        (_a = lsProcess.stderr) === null || _a === void 0 ? void 0 : _a.setEncoding("utf8");
        (_b = lsProcess.stderr) === null || _b === void 0 ? void 0 : _b.on("data", (chunk) => this.onSpawnStdErrData(chunk, projectPath));
    }
    /**
     * The function called whenever the spawned server `error`s. Extend (call super.onSpawnError) or override this if you
     * need custom error handling
     */
    onSpawnError(err) {
        atom.notifications.addError(`${this.getServerName()} language server for ${this.getLanguageName()} unable to start`, {
            dismissable: true,
            description: err.toString(),
        });
    }
    /**
     * The function called whenever the spawned server `close`s. Extend (call super.onSpawnClose) or override this if you
     * need custom close handling
     */
    onSpawnClose(code, signal) {
        if (code !== 0 && signal === null) {
            atom.notifications.addError(`${this.getServerName()} language server for ${this.getLanguageName()} was closed with code: ${code}.`);
        }
    }
    /**
     * The function called whenever the spawned server `disconnect`s. Extend (call super.onSpawnDisconnect) or override
     * this if you need custom disconnect handling
     */
    onSpawnDisconnect() {
        this.logger.debug(`${this.getServerName()} language server for ${this.getLanguageName()} got disconnected.`);
    }
    /**
     * The function called whenever the spawned server `exit`s. Extend (call super.onSpawnExit) or override this if you
     * need custom exit handling
     */
    onSpawnExit(code, signal) {
        this.logger.debug(`exit: code ${code} signal ${signal}`);
    }
    /** (Optional) Finds the project path. If there is a custom logic for finding projects override this method. */
    determineProjectPath(textEditor) {
        const filePath = textEditor.getPath();
        // TODO can filePath be null
        if (filePath === null || filePath === undefined) {
            return null;
        }
        const projectPath = this._serverManager.getNormalizedProjectPaths().find((d) => filePath.startsWith(d));
        if (projectPath !== undefined) {
            return projectPath;
        }
        const serverWithClaim = this._serverManager
            .getActiveServers()
            .find((server) => { var _a; return (_a = server.additionalPaths) === null || _a === void 0 ? void 0 : _a.has(path.dirname(filePath)); });
        if (serverWithClaim !== undefined) {
            return server_manager_js_1.normalizePath(serverWithClaim.projectPath);
        }
        return null;
    }
    /**
     * The function called whenever the spawned server returns `data` in `stderr` Extend (call super.onSpawnStdErrData) or
     * override this if you need custom stderr data handling
     */
    onSpawnStdErrData(chunk, projectPath) {
        const errorString = chunk.toString();
        this.handleServerStderr(errorString, projectPath);
        // Keep the last 5 lines for packages to use in messages
        this.processStdErr = (this.processStdErr + errorString).split("\n").slice(-5).join("\n");
    }
    /** Creates the RPC connection which can be ipc, socket or stdio */
    createRpcConnection(lsProcess) {
        let reader;
        let writer;
        const connectionType = this.getConnectionType();
        switch (connectionType) {
            case "ipc":
                reader = new rpcNode.IPCMessageReader(lsProcess);
                writer = new rpcNode.IPCMessageWriter(lsProcess);
                break;
            case "socket":
                reader = new rpcNode.SocketMessageReader(this.socket);
                writer = new rpcNode.SocketMessageWriter(this.socket);
                break;
            case "stdio":
                if (lsProcess.stdin !== null && lsProcess.stdout !== null) {
                    reader = new rpcNode.StreamMessageReader(lsProcess.stdout);
                    writer = new rpcNode.StreamMessageWriter(lsProcess.stdin);
                }
                else {
                    this.logger.error(`The language server process for ${this.getLanguageName()} does not have a valid stdin and stdout`);
                    return Utils.assertUnreachable("stdio");
                }
                break;
            default:
                return Utils.assertUnreachable(connectionType);
        }
        return rpc.createMessageConnection(reader, writer, {
            log: (..._args) => { },
            warn: (..._args) => { },
            info: (..._args) => { },
            error: (...args) => {
                this.logger.error(args);
            },
        });
    }
    /** Start adapters that are not shared between servers */
    startExclusiveAdapters(server) {
        apply_edit_adapter_1.default.attach(server.connection);
        notifications_adapter_1.default.attach(server.connection, this.name, server.projectPath);
        if (document_sync_adapter_1.default.canAdapt(server.capabilities)) {
            const docSyncAdapter = new document_sync_adapter_1.default(server.connection, (editor) => this.shouldSyncForEditor(editor, server.projectPath), server.capabilities.textDocumentSync, this.reportBusyWhile);
            server.disposable.add(docSyncAdapter);
        }
        const linterPushV2 = new linter_push_v2_adapter_1.default(server.connection);
        if (this._linterDelegate != null) {
            linterPushV2.attach(this._linterDelegate);
        }
        server.disposable.add(linterPushV2);
        const loggingConsole = new logging_console_adapter_1.default(server.connection);
        if (this._consoleDelegate != null) {
            loggingConsole.attach(this._consoleDelegate({ id: this.name, name: this.getLanguageName() }));
        }
        server.disposable.add(loggingConsole);
        let signatureHelpAdapter;
        if (signature_help_adapter_1.default.canAdapt(server.capabilities)) {
            signatureHelpAdapter = new signature_help_adapter_1.default(server, this.getGrammarScopes());
            if (this._signatureHelpRegistry != null) {
                signatureHelpAdapter.attach(this._signatureHelpRegistry);
            }
            server.disposable.add(signatureHelpAdapter);
        }
        this._serverAdapters.set(server, {
            linterPushV2,
            loggingConsole,
            signatureHelpAdapter,
        });
        ShowDocumentAdapter.attach(server.connection);
        server.connection.onWorkspaceFolders(() => this._serverManager.getWorkspaceFolders());
    }
    shouldSyncForEditor(editor, projectPath) {
        return this.isFileInProject(editor, projectPath) && this.shouldStartForEditor(editor);
    }
    isFileInProject(editor, projectPath) {
        return (editor.getPath() || "").startsWith(projectPath);
    }
    // Autocomplete+ via LS completion---------------------------------------
    /**
     * A method to override to return an array of grammar scopes that should not be used for autocompletion.
     *
     * Usually that's used for disabling autocomplete inside comments,
     *
     * @example If the grammar scopes are [ '.source.js' ], `getAutocompleteDisabledScopes` may return [ '.source.js .comment' ].
     */
    getAutocompleteDisabledScopes() {
        return [];
    }
    provideAutocomplete() {
        return {
            selector: this.getGrammarScopes()
                .map((g) => autocomplete_adapter_1.grammarScopeToAutoCompleteSelector(g))
                .join(", "),
            disableForSelector: this.getAutocompleteDisabledScopes()
                .map((g) => autocomplete_adapter_1.grammarScopeToAutoCompleteSelector(g))
                .join(", "),
            inclusionPriority: 1,
            suggestionPriority: 2,
            excludeLowerPriority: false,
            filterSuggestions: true,
            getSuggestions: this.getSuggestions.bind(this),
            onDidInsertSuggestion: (event) => {
                autocomplete_adapter_1.default.applyAdditionalTextEdits(event);
                this.onDidInsertSuggestion(event);
            },
            getSuggestionDetailsOnSelect: this.getSuggestionDetailsOnSelect.bind(this),
        };
    }
    getSuggestions(request) {
        return __awaiter(this, void 0, void 0, function* () {
            const server = yield this._serverManager.getServer(request.editor);
            if (server == null || !autocomplete_adapter_1.default.canAdapt(server.capabilities)) {
                return [];
            }
            this.autoComplete = this.autoComplete || new autocomplete_adapter_1.default();
            this._lastAutocompleteRequest = request;
            return this.autoComplete.getSuggestions(server, request, this.onDidConvertAutocomplete, atom.config.get("autocomplete-plus.minimumWordLength"));
        });
    }
    getSuggestionDetailsOnSelect(suggestion) {
        return __awaiter(this, void 0, void 0, function* () {
            const request = this._lastAutocompleteRequest;
            if (request == null) {
                return null;
            }
            const server = yield this._serverManager.getServer(request.editor);
            if (server == null || !autocomplete_adapter_1.default.canResolve(server.capabilities) || this.autoComplete == null) {
                return null;
            }
            return this.autoComplete.completeSuggestion(server, suggestion, request, this.onDidConvertAutocomplete);
        });
    }
    onDidConvertAutocomplete(_completionItem, _suggestion, _request) { }
    onDidInsertSuggestion(_arg) { }
    // Definitions via LS documentHighlight and gotoDefinition------------
    provideDefinitions() {
        return {
            name: this.name,
            priority: 20,
            grammarScopes: this.getGrammarScopes(),
            wordRegExp: null,
            getDefinition: this.getDefinition.bind(this),
        };
    }
    getDefinition(editor, point) {
        return __awaiter(this, void 0, void 0, function* () {
            const server = yield this._serverManager.getServer(editor);
            if (server == null || !definition_adapter_1.default.canAdapt(server.capabilities)) {
                return null;
            }
            this.definitions = this.definitions || new definition_adapter_1.default();
            const query = yield this.definitions.getDefinition(server.connection, server.capabilities, this.getLanguageName(), editor, point);
            if (query !== null && server.additionalPaths !== undefined) {
                // populate additionalPaths based on definitions
                // Indicates that the language server can support LSP functionality for out of project files indicated by `textDocument/definition` responses.
                for (const def of query.definitions) {
                    server_manager_js_1.considerAdditionalPath(server, path.dirname(def.path));
                }
            }
            return query;
        });
    }
    // Outline View via LS documentSymbol---------------------------------
    provideOutlines() {
        return {
            name: this.name,
            grammarScopes: this.getGrammarScopes(),
            priority: 1,
            getOutline: this.getOutline.bind(this),
        };
    }
    getOutline(editor) {
        return __awaiter(this, void 0, void 0, function* () {
            const server = yield this._serverManager.getServer(editor);
            if (server == null || !outline_view_adapter_1.default.canAdapt(server.capabilities)) {
                return null;
            }
            this.outlineView = this.outlineView || new outline_view_adapter_1.default();
            return this.outlineView.getOutline(server.connection, editor);
        });
    }
    // Call Hierarchy View via LS callHierarchy---------------------------------
    provideCallHierarchy() {
        return {
            name: this.name,
            grammarScopes: this.getGrammarScopes(),
            priority: 1,
            getIncomingCallHierarchy: this.getIncomingCallHierarchy.bind(this),
            getOutgoingCallHierarchy: this.getOutgoingCallHierarchy.bind(this),
        };
    }
    getIncomingCallHierarchy(editor, point) {
        var _a;
        return __awaiter(this, void 0, void 0, function* () {
            const server = yield this._serverManager.getServer(editor);
            if (server === null || !CallHierarchyAdapter.canAdapt(server.capabilities)) {
                return null;
            }
            this.callHierarchy = (_a = this.callHierarchy) !== null && _a !== void 0 ? _a : CallHierarchyAdapter;
            return this.callHierarchy.getCallHierarchy(server.connection, editor, point, "incoming");
        });
    }
    getOutgoingCallHierarchy(editor, point) {
        var _a;
        return __awaiter(this, void 0, void 0, function* () {
            const server = yield this._serverManager.getServer(editor);
            if (server === null || !CallHierarchyAdapter.canAdapt(server.capabilities)) {
                return null;
            }
            this.callHierarchy = (_a = this.callHierarchy) !== null && _a !== void 0 ? _a : CallHierarchyAdapter;
            return this.callHierarchy.getCallHierarchy(server.connection, editor, point, "outgoing");
        });
    }
    // Linter push v2 API via LS publishDiagnostics
    consumeLinterV2(registerIndie) {
        this._linterDelegate = registerIndie({ name: this.name });
        if (this._linterDelegate == null) {
            return;
        }
        for (const server of this._serverManager.getActiveServers()) {
            const linterPushV2 = this.getServerAdapter(server, "linterPushV2");
            if (linterPushV2 != null) {
                linterPushV2.attach(this._linterDelegate);
            }
        }
    }
    // Find References via LS findReferences------------------------------
    provideFindReferences() {
        return {
            isEditorSupported: (editor) => this.getGrammarScopes().includes(editor.getGrammar().scopeName),
            findReferences: this.getReferences.bind(this),
        };
    }
    getReferences(editor, point) {
        return __awaiter(this, void 0, void 0, function* () {
            const server = yield this._serverManager.getServer(editor);
            if (server == null || !find_references_adapter_1.default.canAdapt(server.capabilities)) {
                return null;
            }
            this.findReferences = this.findReferences || new find_references_adapter_1.default();
            return this.findReferences.getReferences(server.connection, editor, point, server.projectPath);
        });
    }
    // Datatip via LS textDocument/hover----------------------------------
    consumeDatatip(service) {
        this._disposable.add(service.addProvider({
            providerName: this.name,
            priority: 1,
            grammarScopes: this.getGrammarScopes(),
            validForScope: (scopeName) => {
                return this.getGrammarScopes().includes(scopeName);
            },
            datatip: this.getDatatip.bind(this),
        }));
    }
    getDatatip(editor, point) {
        return __awaiter(this, void 0, void 0, function* () {
            const server = yield this._serverManager.getServer(editor);
            if (server == null || !datatip_adapter_1.default.canAdapt(server.capabilities)) {
                return null;
            }
            this.datatip = this.datatip || new datatip_adapter_1.default();
            return this.datatip.getDatatip(server.connection, editor, point);
        });
    }
    // Console via LS logging---------------------------------------------
    consumeConsole(createConsole) {
        this._consoleDelegate = createConsole;
        for (const server of this._serverManager.getActiveServers()) {
            const loggingConsole = this.getServerAdapter(server, "loggingConsole");
            if (loggingConsole) {
                loggingConsole.attach(this._consoleDelegate({ id: this.name, name: this.getLanguageName() }));
            }
        }
        // No way of detaching from client connections today
        return new atom_1.Disposable(() => { });
    }
    // Code Format via LS formatDocument & formatDocumentRange------------
    provideCodeFormat() {
        return {
            grammarScopes: this.getGrammarScopes(),
            priority: 1,
            formatCode: this.getCodeFormat.bind(this),
        };
    }
    getCodeFormat(editor, range) {
        return __awaiter(this, void 0, void 0, function* () {
            const server = yield this._serverManager.getServer(editor);
            if (server == null || !code_format_adapter_1.default.canAdapt(server.capabilities)) {
                return [];
            }
            return code_format_adapter_1.default.format(server.connection, server.capabilities, editor, range);
        });
    }
    provideRangeCodeFormat() {
        return {
            grammarScopes: this.getGrammarScopes(),
            priority: 1,
            formatCode: this.getRangeCodeFormat.bind(this),
        };
    }
    getRangeCodeFormat(editor, range) {
        return __awaiter(this, void 0, void 0, function* () {
            const server = yield this._serverManager.getServer(editor);
            if (server == null || !server.capabilities.documentRangeFormattingProvider) {
                return [];
            }
            return code_format_adapter_1.default.formatRange(server.connection, editor, range);
        });
    }
    provideFileCodeFormat() {
        return {
            grammarScopes: this.getGrammarScopes(),
            priority: 1,
            formatEntireFile: this.getFileCodeFormat.bind(this),
        };
    }
    provideOnSaveCodeFormat() {
        return {
            grammarScopes: this.getGrammarScopes(),
            priority: 1,
            formatOnSave: this.getFileCodeFormat.bind(this),
        };
    }
    getFileCodeFormat(editor) {
        return __awaiter(this, void 0, void 0, function* () {
            const server = yield this._serverManager.getServer(editor);
            if (server == null || !server.capabilities.documentFormattingProvider) {
                return [];
            }
            return code_format_adapter_1.default.formatDocument(server.connection, editor);
        });
    }
    provideOnTypeCodeFormat() {
        return {
            grammarScopes: this.getGrammarScopes(),
            priority: 1,
            formatAtPosition: this.getOnTypeCodeFormat.bind(this),
        };
    }
    getOnTypeCodeFormat(editor, point, character) {
        return __awaiter(this, void 0, void 0, function* () {
            const server = yield this._serverManager.getServer(editor);
            if (server == null || !server.capabilities.documentOnTypeFormattingProvider) {
                return [];
            }
            return code_format_adapter_1.default.formatOnType(server.connection, editor, point, character);
        });
    }
    provideCodeHighlight() {
        return {
            grammarScopes: this.getGrammarScopes(),
            priority: 1,
            highlight: (editor, position) => {
                return this.getCodeHighlight(editor, position);
            },
        };
    }
    getCodeHighlight(editor, position) {
        return __awaiter(this, void 0, void 0, function* () {
            const server = yield this._serverManager.getServer(editor);
            if (server == null || !code_highlight_adapter_1.default.canAdapt(server.capabilities)) {
                return null;
            }
            return code_highlight_adapter_1.default.highlight(server.connection, server.capabilities, editor, position);
        });
    }
    provideCodeActions() {
        return {
            grammarScopes: this.getGrammarScopes(),
            priority: 1,
            getCodeActions: (editor, range, diagnostics) => {
                return this.getCodeActions(editor, range, diagnostics);
            },
        };
    }
    getCodeActions(editor, range, diagnostics) {
        return __awaiter(this, void 0, void 0, function* () {
            const server = yield this._serverManager.getServer(editor);
            if (server == null || !code_action_adapter_1.default.canAdapt(server.capabilities)) {
                return null;
            }
            return code_action_adapter_1.default.getCodeActions(server.connection, server.capabilities, this.getServerAdapter(server, "linterPushV2"), editor, range, diagnostics, this.filterCodeActions.bind(this), this.onApplyCodeActions.bind(this));
        });
    }
    /** Optionally filter code action before they're displayed */
    filterCodeActions(actions) {
        return actions;
    }
    /**
     * Optionally handle a code action before default handling. Return `false` to prevent default handling, `true` to
     * continue with default handling.
     */
    onApplyCodeActions(_action) {
        return __awaiter(this, void 0, void 0, function* () {
            return true;
        });
    }
    provideRefactor() {
        return {
            grammarScopes: this.getGrammarScopes(),
            priority: 1,
            rename: this.getRename.bind(this),
        };
    }
    getRename(editor, position, newName) {
        return __awaiter(this, void 0, void 0, function* () {
            const server = yield this._serverManager.getServer(editor);
            if (server == null || !rename_adapter_1.default.canAdapt(server.capabilities)) {
                return null;
            }
            return rename_adapter_1.default.getRename(server.connection, editor, position, newName);
        });
    }
    consumeSignatureHelp(registry) {
        this._signatureHelpRegistry = registry;
        for (const server of this._serverManager.getActiveServers()) {
            const signatureHelpAdapter = this.getServerAdapter(server, "signatureHelpAdapter");
            if (signatureHelpAdapter != null) {
                signatureHelpAdapter.attach(registry);
            }
        }
        return new atom_1.Disposable(() => {
            this._signatureHelpRegistry = undefined;
        });
    }
    consumeBusySignal(service) {
        this.busySignalService = service;
        return new atom_1.Disposable(() => delete this.busySignalService);
    }
    /**
     * `didChangeWatchedFiles` message filtering, override for custom logic.
     *
     * @param filePath Path of a file that has changed in the project path
     * @returns `false` => message will not be sent to the language server
     */
    filterChangeWatchedFiles(_filePath) {
        return true;
    }
    /**
     * Called on language server stderr output.
     *
     * @param stderr A chunk of stderr from a language server instance
     */
    handleServerStderr(stderr, _projectPath) {
        stderr
            .split("\n")
            .filter((l) => l)
            .forEach((line) => this.logger.warn(`stderr ${line}`));
    }
    getServerAdapter(server, adapter) {
        const adapters = this._serverAdapters.get(server);
        return adapters && adapters[adapter];
    }
}
exports.default = AutoLanguageClient;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0by1sYW5ndWFnZWNsaWVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL2xpYi9hdXRvLWxhbmd1YWdlY2xpZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUFBLG9DQUFtQztBQUVuQyxzQ0FBcUM7QUFDckMsK0NBQThDO0FBQzlDLDZCQUE0QjtBQUc1Qiw2Q0FBa0M7QUFDbEMsc0VBQTREO0FBQzVELDBFQUF5RztBQUN6RywwRUFBeUU7QUFDekUsd0VBQThEO0FBQzlELHdFQUE4RDtBQUM5RCw4RUFBb0U7QUFDcEUsZ0VBQXVEO0FBQ3ZELHNFQUE2RDtBQUM3RCw0RUFBa0U7QUFDbEUsZ0ZBQXNFO0FBQ3RFLDhFQUFtRTtBQUNuRSxnRkFBc0U7QUFDdEUsNEVBQW1FO0FBQ25FLDBFQUFnRTtBQUNoRSw4REFBcUQ7QUFDckQsOEVBQW9FO0FBQ3BFLHdFQUF1RTtBQUN2RSxpQ0FBZ0M7QUFFaEMscURBQTJEO0FBYXBDLHlHQWJkLHlDQUF3QixPQWFjO0FBWi9DLHFDQUFnRTtBQUNoRSwyREFNNEI7QUFDNUIsK0JBQWdGO0FBRWhGLCtCQUErQjtBQVcvQjs7Ozs7Ozs7R0FRRztBQUNILE1BQXFCLGtCQUFrQjtJQUF2QztRQU9VLG9CQUFlLEdBQVksS0FBSyxDQUFBO1FBQ2hDLG9CQUFlLEdBQUcsSUFBSSxPQUFPLEVBQWdDLENBQUE7UUFLM0Qsa0JBQWEsR0FBVyxFQUFFLENBQUE7UUFzOUJwQzs7O1dBR0c7UUFDTyx1QkFBa0IsR0FBWSxJQUFJLENBQUE7UUFzQmxDLG9CQUFlLEdBQTBCLENBQU8sS0FBSyxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQ3BFLElBQUksSUFBSSxDQUFDLGlCQUFpQixFQUFFO2dCQUMxQixPQUFPLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxlQUFlLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFBO2FBQ3hEO2lCQUFNO2dCQUNMLE9BQU8sSUFBSSxDQUFDLHNCQUFzQixDQUFD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QUVPLGdCQUFnQixDQUN0QixNQUFvQixFQUNwQixPQUFVO1FBRVYsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUE7UUFDakQsT0FBTyxRQUFRLElBQUksUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFBO0lBQ3RDLENBQUM7Q0FvQkY7QUEvZ0NELHFDQStnQ0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBjcCBmcm9tIFwiY2hpbGRfcHJvY2Vzc1wiXG5pbXBvcnQgKiBhcyBscyBmcm9tIFwiLi9sYW5ndWFnZWNsaWVudFwiXG5pbXBvcnQgKiBhcyBycGMgZnJvbSBcInZzY29kZS1qc29ucnBjXCJcbmltcG9ydCAqIGFzIHJwY05vZGUgZnJvbSBcInZzY29kZS1qc29ucnBjL25vZGVcIlxuaW1wb3J0ICogYXMgcGF0aCBmcm9tIFwicGF0aFwiXG5pbXBvcnQgKiBhcyBhdG9tSWRlIGZyb20gXCJhdG9tLWlkZVwiXG5pbXBvcnQgKiBhcyBsaW50ZXIgZnJvbSBcImF0b20vbGludGVyXCJcbmltcG9ydCBDb252ZXJ0IGZyb20gXCIuL2NvbnZlcnQuanNcIlxuaW1wb3J0IEFwcGx5RWRpdEFkYXB0ZXIgZnJvbSBcIi4vYWRhcHRlcnMvYXBwbHktZWRpdC1hZGFwdGVyXCJcbmltcG9ydCBBdXRvY29tcGxldGVBZGFwdGVyLCB7IGdyYW1tYXJTY29wZVRvQXV0b0NvbXBsZXRlU2VsZWN0b3IgfSBmcm9tIFwiLi9hZGFwdGVycy9hdXRvY29tcGxldGUtYWRhcHRlclwiXG5pbXBvcnQgKiBhcyBDYWxsSGllcmFyY2h5QWRhcHRlciBmcm9tIFwiLi9hZGFwdGVycy9jYWxsLWhpZXJhcmNoeS1hZGFwdGVyXCJcbmltcG9ydCBDb2RlQWN0aW9uQWRhcHRlciBmcm9tIFwiLi9hZGFwdGVycy9jb2RlLWFjdGlvbi1hZGFwdGVyXCJcbmltcG9ydCBDb2RlRm9ybWF0QWRhcHRlciBmcm9tIFwiLi9hZGFwdGVycy9jb2RlLWZvcm1hdC1hZGFwdGVyXCJcbmltcG9ydCBDb2RlSGlnaGxpZ2h0QWRhcHRlciBmcm9tIFwiLi9hZGFwdGVycy9jb2RlLWhpZ2hsaWdodC1hZGFwdGVyXCJcbmltcG9ydCBEYXRhdGlwQWRhcHRlciBmcm9tIFwiLi9hZGFwdGVycy9kYXRhdGlwLWFkYXB0ZXJcIlxuaW1wb3J0IERlZmluaXRpb25BZGFwdGVyIGZyb20gXCIuL2FkYXB0ZXJzL2RlZmluaXRpb24tYWRhcHRlclwiXG5pbXBvcnQgRG9jdW1lbnRTeW5jQWRhcHRlciBmcm9tIFwiLi9hZGFwdGVycy9kb2N1bWVudC1zeW5jLWFkYXB0ZXJcIlxuaW1wb3J0IEZpbmRSZWZlcmVuY2VzQWRhcHRlciBmcm9tIFwiLi9hZGFwdGVycy9maW5kLXJlZmVyZW5jZXMtYWRhcHRlclwiXG5pbXBvcnQgTGludGVyUHVzaFYyQWRhcHRlciBmcm9tIFwiLi9hZGFwdGVycy9saW50ZXItcHVzaC12Mi1hZGFwdGVyXCJcbmltcG9ydCBMb2dnaW5nQ29uc29sZUFkYXB0ZXIgZnJvbSBcIi4vYWRhcHRlcnMvbG9nZ2luZy1jb25zb2xlLWFkYXB0ZXJcIlxuaW1wb3J0IE5vdGlmaWNhdGlvbnNBZGFwdGVyIGZyb20gXCIuL2FkYXB0ZXJzL25vdGlmaWNhdGlvbnMtYWRhcHRlclwiXG5pbXBvcnQgT3V0bGluZVZpZXdBZGFwdGVyIGZyb20gXCIuL2FkYXB0ZXJzL291dGxpbmUtdmlldy1hZGFwdGVyXCJcbmltcG9ydCBSZW5hbWVBZGFwdGVyIGZyb20gXCIuL2FkYXB0ZXJzL3JlbmFtZS1hZGFwdGVyXCJcbmltcG9ydCBTaWduYXR1cmVIZWxwQWRhcHRlciBmcm9tIFwiLi9hZGFwdGVycy9zaWduYXR1cmUtaGVscC1hZGFwdGVyXCJcbmltcG9ydCAqIGFzIFNob3dEb2N1bWVudEFkYXB0ZXIgZnJvbSBcIi4vYWRhcHRlcnMvc2hvdy1kb2N1bWVudC1hZGFwdGVyXCJcbmltcG9ydCAqIGFzIFV0aWxzIGZyb20gXCIuL3V0aWxzXCJcbmltcG9ydCB7IFNvY2tldCB9IGZyb20gXCJuZXRcIlxuaW1wb3J0IHsgTGFuZ3VhZ2VDbGllbnRDb25uZWN0aW9uIH0gZnJvbSBcIi4vbGFuZ3VhZ2VjbGllbnRcIlxuaW1wb3J0IHsgQ29uc29sZUxvZ2dlciwgRmlsdGVyZWRMb2dnZXIsIExvZ2dlciB9IGZyb20gXCIuL2xvZ2dlclwiXG5pbXBvcnQge1xuICBMYW5ndWFnZVNlcnZlclByb2Nlc3MsXG4gIFNlcnZlck1hbmFnZXIsXG4gIEFjdGl2ZVNlcnZlcixcbiAgbm9ybWFsaXplUGF0aCxcbiAgY29uc2lkZXJBZGRpdGlvbmFsUGF0aCxcbn0gZnJvbSBcIi4vc2VydmVyLW1hbmFnZXIuanNcIlxuaW1wb3J0IHsgRGlzcG9zYWJsZSwgQ29tcG9zaXRlRGlzcG9zYWJsZSwgUG9pbnQsIFJhbmdlLCBUZXh0RWRpdG9yIH0gZnJvbSBcImF0b21cIlxuaW1wb3J0ICogYXMgYWMgZnJvbSBcImF0b20vYXV0b2NvbXBsZXRlLXBsdXNcIlxuaW1wb3J0IHsgYmFzZW5hbWUgfSBmcm9tIFwicGF0aFwiXG5cbmV4cG9ydCB7IEFjdGl2ZVNlcnZlciwgTGFuZ3VhZ2VDbGllbnRDb25uZWN0aW9uLCBMYW5ndWFnZVNlcnZlclByb2Nlc3MgfVxuZXhwb3J0IHR5cGUgQ29ubmVjdGlvblR5cGUgPSBcInN0ZGlvXCIgfCBcInNvY2tldFwiIHwgXCJpcGNcIlxuXG5leHBvcnQgaW50ZXJmYWNlIFNlcnZlckFkYXB0ZXJzIHtcbiAgbGludGVyUHVzaFYyOiBMaW50ZXJQdXNoVjJBZGFwdGVyXG4gIGxvZ2dpbmdDb25zb2xlOiBMb2dnaW5nQ29uc29sZUFkYXB0ZXJcbiAgc2lnbmF0dXJlSGVscEFkYXB0ZXI/OiBTaWduYXR1cmVIZWxwQWRhcHRlclxufVxuXG4vKipcbiAqIFB1YmxpYzogQXV0b0xhbmd1YWdlQ2xpZW50IHByb3ZpZGVzIGEgc2ltcGxlIHdheSB0byBoYXZlIGFsbCB0aGUgc3VwcG9ydGVkIEF0b20tSURFIHNlcnZpY2VzIHdpcmVkIHVwIGVudGlyZWx5IGZvclxuICogeW91IGJ5IGp1c3Qgc3ViY2xhc3NpbmcgaXQgYW5kIGltcGxlbWVudGluZyBhdCBsZWFzdFxuICpcbiAqIC0gYHN0YXJ0U2VydmVyUHJvY2Vzc2BcbiAqIC0gYGdldEdyYW1tYXJTY29wZXNgXG4gKiAtIGBnZXRMYW5ndWFnZU5hbWVgXG4gKiAtIGBnZXRTZXJ2ZXJOYW1lYFxuICovXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBdXRvTGFuZ3VhZ2VDbGllbnQge1xuICBwcml2YXRlIF9kaXNwb3NhYmxlITogQ29tcG9zaXRlRGlzcG9zYWJsZVxuICBwcml2YXRlIF9zZXJ2ZXJNYW5hZ2VyITogU2VydmVyTWFuYWdlclxuICBwcml2YXRlIF9jb25zb2xlRGVsZWdhdGU/OiBhdG9tSWRlLkNvbnNvbGVTZXJ2aWNlXG4gIHByaXZhdGUgX2xpbnRlckRlbGVnYXRlPzogbGludGVyLkluZGllRGVsZWdhdGVcbiAgcHJpdmF0ZSBfc2lnbmF0dXJlSGVscFJlZ2lzdHJ5PzogYXRvbUlkZS5TaWduYXR1cmVIZWxwUmVnaXN0cnlcbiAgcHJpdmF0ZSBfbGFzdEF1dG9jb21wbGV0ZVJlcXVlc3Q/OiBhYy5TdWdnZXN0aW9uc1JlcXVlc3RlZEV2ZW50XG4gIHByaXZhdGUgX2lzRGVhY3RpdmF0aW5nOiBib29sZWFuID0gZmFsc2VcbiAgcHJpdmF0ZSBfc2VydmVyQWRhcHRlcnMgPSBuZXcgV2Vha01hcDxBY3RpdmVTZXJ2ZXIsIFNlcnZlckFkYXB0ZXJzPigpXG5cbiAgLyoqIEF2YWlsYWJsZSBpZiBjb25zdW1lQnVzeVNpZ25hbCBpcyBzZXR1cCAqL1xuICBwcm90ZWN0ZWQgYnVzeVNpZ25hbFNlcnZpY2U/OiBhdG9tSWRlLkJ1c3lTaWduYWxTZXJ2aWNlXG5cbiAgcHJvdGVjdGVkIHByb2Nlc3NTdGRFcnI6IHN0cmluZyA9IFwiXCJcbiAgcHJvdGVjdGVkIGxvZ2dlciE6IExvZ2dlclxuICBwcm90ZWN0ZWQgbmFtZSE6IHN0cmluZ1xuICBwcm90ZWN0ZWQgc29ja2V0ITogU29ja2V0XG5cbiAgLy8gU2hhcmVkIGFkYXB0ZXJzIHRoYXQgY2FuIHRha2UgdGhlIFJQQyBjb25uZWN0aW9uIGFzIHJlcXVpcmVkXG4gIHByb3RlY3RlZCBhdXRvQ29tcGxldGU/OiBBdXRvY29tcGxldGVBZGFwdGVyXG4gIHByb3RlY3RlZCBjYWxsSGllcmFyY2h5PzogdHlwZW9mIENhbGxIaWVyYXJjaHlBZGFwdGVyXG4gIHByb3RlY3RlZCBkYXRhdGlwPzogRGF0YXRpcEFkYXB0ZXJcbiAgcHJvdGVjdGVkIGRlZmluaXRpb25zPzogRGVmaW5pdGlvbkFkYXB0ZXJcbiAgcHJvdGVjdGVkIGZpbmRSZWZlcmVuY2VzPzogRmluZFJlZmVyZW5jZXNBZGFwdGVyXG4gIHByb3RlY3RlZCBvdXRsaW5lVmlldz86IE91dGxpbmVWaWV3QWRhcHRlclxuXG4gIC8vIFlvdSBtdXN0IGltcGxlbWVudCB0aGVzZSBzbyB3ZSBrbm93IGhvdyB0byBkZWFsIHdpdGggeW91ciBsYW5ndWFnZSBhbmQgc2VydmVyXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAvKiogUmV0dXJuIGFuIGFycmF5IG9mIHRoZSBncmFtbWFyIHNjb3BlcyB5b3UgaGFuZGxlLCBlLmcuIFsgJ3NvdXJjZS5qcycgXSAqL1xuICBwcm90ZWN0ZWQgZ2V0R3JhbW1hclNjb3BlcygpOiBzdHJpbmdbXSB7XG4gICAgdGhyb3cgRXJyb3IoXCJNdXN0IGltcGxlbWVudCBnZXRHcmFtbWFyU2NvcGVzIHdoZW4gZXh0ZW5kaW5nIEF1dG9MYW5ndWFnZUNsaWVudFwiKVxuICB9XG5cbiAgLyoqIFJldHVybiB0aGUgbmFtZSBvZiB0aGUgbGFuZ3VhZ2UgeW91IHN1cHBvcnQsIGUuZy4gJ0phdmFTY3JpcHQnICovXG4gIHByb3RlY3RlZCBnZXRMYW5ndWFnZU5hbWUoKTogc3RyaW5nIHtcbiAgICB0aHJvdyBFcnJvcihcIk11c3QgaW1wbGVtZW50IGdldExhbmd1YWdlTmFtZSB3aGVuIGV4dGVuZGluZyBBdXRvTGFuZ3VhZ2VDbGllbnRcIilcbiAgfVxuXG4gIC8qKiBSZXR1cm4gdGhlIG5hbWUgb2YgeW91ciBzZXJ2ZXIsIGUuZy4gJ0VjbGlwc2UgSkRUJyAqL1xuICBwcm90ZWN0ZWQgZ2V0U2VydmVyTmFtZSgpOiBzdHJpbmcge1xuICAgIHRocm93IEVycm9yKFwiTXVzdCBpbXBsZW1lbnQgZ2V0U2VydmVyTmFtZSB3aGVuIGV4dGVuZGluZyBBdXRvTGFuZ3VhZ2VDbGllbnRcIilcbiAgfVxuXG4gIC8qKiBTdGFydCB5b3VyIHNlcnZlciBwcm9jZXNzICovXG4gIHByb3RlY3RlZCBzdGFydFNlcnZlclByb2Nlc3MoX3Byb2plY3RQYXRoOiBzdHJpbmcpOiBMYW5ndWFnZVNlcnZlclByb2Nlc3MgfCBQcm9taXNlPExhbmd1YWdlU2VydmVyUHJvY2Vzcz4ge1xuICAgIHRocm93IEVycm9yKFwiTXVzdCBvdmVycmlkZSBzdGFydFNlcnZlclByb2Nlc3MgdG8gc3RhcnQgbGFuZ3VhZ2Ugc2VydmVyIHByb2Nlc3Mgd2hlbiBleHRlbmRpbmcgQXV0b0xhbmd1YWdlQ2xpZW50XCIpXG4gIH1cblxuICAvLyBZb3UgbWlnaHQgd2FudCB0byBvdmVycmlkZSB0aGVzZSBmb3IgZGlmZmVyZW50IGJlaGF2aW9yXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gIC8qKiAoT3B0aW9uYWwpIERldGVybWluZSB3aGV0aGVyIHdlIHNob3VsZCBzdGFydCBhIHNlcnZlciBmb3IgYSBnaXZlbiBlZGl0b3IgaWYgd2UgZG9uJ3QgaGF2ZSBvbmUgeWV0ICovXG4gIHByb3RlY3RlZCBzaG91bGRTdGFydEZvckVkaXRvcihlZGl0b3I6IFRleHRFZGl0b3IpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5nZXRHcmFtbWFyU2NvcGVzKCkuaW5jbHVkZXMoZWRpdG9yLmdldEdyYW1tYXIoKS5zY29wZU5hbWUpXG4gIH1cblxuICAvKiogKE9wdGlvbmFsKSBSZXR1cm4gdGhlIHBhcmFtZXRlcnMgdXNlZCB0byBpbml0aWFsaXplIGEgY2xpZW50IC0geW91IG1heSB3YW50IHRvIGV4dGVuZCBjYXBhYmlsaXRpZXMgKi9cbiAgcHJvdGVjdGVkIGdldEluaXRpYWxpemVQYXJhbXMocHJvamVjdFBhdGg6IHN0cmluZywgbHNQcm9jZXNzOiBMYW5ndWFnZVNlcnZlclByb2Nlc3MpOiBscy5Jbml0aWFsaXplUGFyYW1zIHtcbiAgICBjb25zdCByb290VXJpID0gQ29udmVydC5wYXRoVG9VcmkocHJvamVjdFBhdGgpXG4gICAgcmV0dXJuIHtcbiAgICAgIHByb2Nlc3NJZDogbHNQcm9jZXNzLnBpZCAhPT0gdW5kZWZpbmVkID8gbHNQcm9jZXNzLnBpZCA6IG51bGwsXG4gICAgICByb290UGF0aDogcHJvamVjdFBhdGgsXG4gICAgICByb290VXJpLFxuICAgICAgbG9jYWxlOiBhdG9tLmNvbmZpZy5nZXQoXCJhdG9tLWkxOG4ubG9jYWxlXCIpIHx8IFwiZW5cIixcbiAgICAgIHdvcmtzcGFjZUZvbGRlcnM6IFt7IHVyaTogcm9vdFVyaSwgbmFtZTogYmFzZW5hbWUocHJvamVjdFBhdGgpIH1dLFxuICAgICAgLy8gVGhlIGNhcGFiaWxpdGllcyBzdXBwb3J0ZWQuXG4gICAgICAvLyBUT0RPIHRoZSBjYXBhYmlsaXRpZXMgc2V0IHRvIGZhbHNlL3VuZGVmaW5lZCBhcmUgVE9ETy4gU2VlIHtscy5TZXJ2ZXJDYXBhYmlsaXRpZXN9IGZvciBhIGZ1bGwgbGlzdC5cbiAgICAgIGNhcGFiaWxpdGllczoge1xuICAgICAgICB3b3Jrc3BhY2U6IHtcbiAgICAgICAgICBhcHBseUVkaXQ6IHRydWUsXG4gICAgICAgICAgY29uZmlndXJhdGlvbjogZmFsc2UsXG4gICAgICAgICAgd29ya3NwYWNlRWRpdDoge1xuICAgICAgICAgICAgZG9jdW1lbnRDaGFuZ2VzOiB0cnVlLFxuICAgICAgICAgICAgbm9ybWFsaXplc0xpbmVFbmRpbmdzOiBmYWxzZSxcbiAgICAgICAgICAgIGNoYW5nZUFubm90YXRpb25TdXBwb3J0OiB1bmRlZmluZWQsXG4gICAgICAgICAgICByZXNvdXJjZU9wZXJhdGlvbnM6IFtcImNyZWF0ZVwiLCBcInJlbmFtZVwiLCBcImRlbGV0ZVwiXSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHdvcmtzcGFjZUZvbGRlcnM6IHRydWUsXG4gICAgICAgICAgZGlkQ2hhbmdlQ29uZmlndXJhdGlvbjoge1xuICAgICAgICAgICAgZHluYW1pY1JlZ2lzdHJhdGlvbjogZmFsc2UsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBkaWRDaGFuZ2VXYXRjaGVkRmlsZXM6IHtcbiAgICAgICAgICAgIGR5bmFtaWNSZWdpc3RyYXRpb246IGZhbHNlLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgLy8gQkxPQ0tFRDogb24gYXRvbS9zeW1ib2xzLXZpZXdcbiAgICAgICAgICBzeW1ib2w6IHtcbiAgICAgICAgICAgIGR5bmFtaWNSZWdpc3RyYXRpb246IGZhbHNlLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgZXhlY3V0ZUNvbW1hbmQ6IHtcbiAgICAgICAgICAgIGR5bmFtaWNSZWdpc3RyYXRpb246IGZhbHNlLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgc2VtYW50aWNUb2tlbnM6IHVuZGVmaW5lZCxcbiAgICAgICAgICBjb2RlTGVuczogdW5kZWZpbmVkLFxuICAgICAgICAgIGZpbGVPcGVyYXRpb25zOiB7XG4gICAgICAgICAgICAvLyBCTE9DS0VEOiBvbiB0cmVlLXZpZXcgbm90IHByb3ZpZGluZyBob29rcyBmb3IgXCJiZWZvcmUgZmlsZS9kaXIgY3JlYXRlZFwiXG4gICAgICAgICAgICB3aWxsQ3JlYXRlOiBmYWxzZSxcbiAgICAgICAgICAgIC8vIEJMT0NLRUQ6IG9uIHRyZWUtdmlldyBub3QgcHJvdmlkaW5nIGhvb2tzIGZvciBcImJlZm9yZSBmaWxlL2RpciByZW5hbWVkXCJcbiAgICAgICAgICAgIHdpbGxSZW5hbWU6IGZhbHNlLFxuICAgICAgICAgICAgLy8gQkxPQ0tFRDogb24gdHJlZS12aWV3IG5vdCBwcm92aWRpbmcgaG9va3MgZm9yIFwiYmVmb3JlIGZpbGUvZGlyIGRlbGV0ZWRcIlxuICAgICAgICAgICAgd2lsbERlbGV0ZTogZmFsc2UsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgdGV4dERvY3VtZW50OiB7XG4gICAgICAgICAgc3luY2hyb25pemF0aW9uOiB7XG4gICAgICAgICAgICBkeW5hbWljUmVnaXN0cmF0aW9uOiBmYWxzZSxcbiAgICAgICAgICAgIHdpbGxTYXZlOiB0cnVlLFxuICAgICAgICAgICAgd2lsbFNhdmVXYWl0VW50aWw6IHRydWUsXG4gICAgICAgICAgICBkaWRTYXZlOiB0cnVlLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgY29tcGxldGlvbjoge1xuICAgICAgICAgICAgZHluYW1pY1JlZ2lzdHJhdGlvbjogZmFsc2UsXG4gICAgICAgICAgICBjb21wbGV0aW9uSXRlbToge1xuICAgICAgICAgICAgICBzbmlwcGV0U3VwcG9ydDogdHJ1ZSxcbiAgICAgICAgICAgICAgY29tbWl0Q2hhcmFjdGVyc1N1cHBvcnQ6IGZhbHNlLFxuICAgICAgICAgICAgICBkb2N1bWVudGF0aW9uRm9ybWF0OiBbXSxcbiAgICAgICAgICAgICAgZGVwcmVjYXRlZFN1cHBvcnQ6IGZhbHNlLFxuICAgICAgICAgICAgICBwcmVzZWxlY3RTdXBwb3J0OiBmYWxzZSxcbiAgICAgICAgICAgICAgdGFnU3VwcG9ydDoge1xuICAgICAgICAgICAgICAgIHZhbHVlU2V0OiBbXSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgaW5zZXJ0UmVwbGFjZVN1cHBvcnQ6IGZhbHNlLFxuICAgICAgICAgICAgICByZXNvbHZlU3VwcG9ydDoge1xuICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IFtdLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBpbnNlcnRUZXh0TW9kZVN1cHBvcnQ6IHtcbiAgICAgICAgICAgICAgICB2YWx1ZVNldDogW10sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29tcGxldGlvbkl0ZW1LaW5kOiB7XG4gICAgICAgICAgICAgIHZhbHVlU2V0OiBbXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250ZXh0U3VwcG9ydDogdHJ1ZSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGhvdmVyOiB7XG4gICAgICAgICAgICBkeW5hbWljUmVnaXN0cmF0aW9uOiBmYWxzZSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNpZ25hdHVyZUhlbHA6IHtcbiAgICAgICAgICAgIGR5bmFtaWNSZWdpc3RyYXRpb246IGZhbHNlLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgZGVjbGFyYXRpb246IHVuZGVmaW5lZCxcbiAgICAgICAgICByZWZlcmVuY2VzOiB7XG4gICAgICAgICAgICBkeW5hbWljUmVnaXN0cmF0aW9uOiBmYWxzZSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGRvY3VtZW50SGlnaGxpZ2h0OiB7XG4gICAgICAgICAgICBkeW5hbWljUmVnaXN0cmF0aW9uOiBmYWxzZSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGRvY3VtZW50U3ltYm9sOiB7XG4gICAgICAgICAgICBkeW5hbWljUmVnaXN0cmF0aW9uOiBmYWxzZSxcbiAgICAgICAgICAgIGhpZXJhcmNoaWNhbERvY3VtZW50U3ltYm9sU3VwcG9ydDogdHJ1ZSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGZvcm1hdHRpbmc6IHtcbiAgICAgICAgICAgIGR5bmFtaWNSZWdpc3RyYXRpb246IGZhbHNlLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgcmFuZ2VGb3JtYXR0aW5nOiB7XG4gICAgICAgICAgICBkeW5hbWljUmVnaXN0cmF0aW9uOiBmYWxzZSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIG9uVHlwZUZvcm1hdHRpbmc6IHtcbiAgICAgICAgICAgIGR5bmFtaWNSZWdpc3RyYXRpb246IGZhbHNlLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgZGVmaW5pdGlvbjoge1xuICAgICAgICAgICAgZHluYW1pY1JlZ2lzdHJhdGlvbjogZmFsc2UsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBjb2RlQWN0aW9uOiB7XG4gICAgICAgICAgICBkeW5hbWljUmVnaXN0cmF0aW9uOiBmYWxzZSxcbiAgICAgICAgICAgIGNvZGVBY3Rpb25MaXRlcmFsU3VwcG9ydDoge1xuICAgICAgICAgICAgICBjb2RlQWN0aW9uS2luZDoge1xuICAgICAgICAgICAgICAgIHZhbHVlU2V0OiBbXCJcIl0sIC8vIFRPRE8gZXhwbGljaXRseSBzdXBwb3J0IG1vcmU/XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgY29kZUxlbnM6IHtcbiAgICAgICAgICAgIGR5bmFtaWNSZWdpc3RyYXRpb246IGZhbHNlLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgZG9jdW1lbnRMaW5rOiB7XG4gICAgICAgICAgICBkeW5hbWljUmVnaXN0cmF0aW9uOiBmYWxzZSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHJlbmFtZToge1xuICAgICAgICAgICAgZHluYW1pY1JlZ2lzdHJhdGlvbjogZmFsc2UsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBtb25pa2VyOiB7XG4gICAgICAgICAgICBkeW5hbWljUmVnaXN0cmF0aW9uOiBmYWxzZSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHB1Ymxpc2hEaWFnbm9zdGljczoge1xuICAgICAgICAgICAgcmVsYXRlZEluZm9ybWF0aW9uOiB0cnVlLFxuICAgICAgICAgICAgdGFnU3VwcG9ydDoge1xuICAgICAgICAgICAgICAvLyBCTE9DS0VEOiBvbiBzdGVlbGJyYWluL2xpbnRlciBzdXBwb3J0aW5nIHdheXMgb2YgZGVub3RpbmcgdXNlbGVzcyBjb2RlIGFuZCBkZXByZWNhdGVkIHN5bWJvbHNcbiAgICAgICAgICAgICAgdmFsdWVTZXQ6IFtdLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHZlcnNpb25TdXBwb3J0OiBmYWxzZSxcbiAgICAgICAgICAgIGNvZGVEZXNjcmlwdGlvblN1cHBvcnQ6IHRydWUsXG4gICAgICAgICAgICBkYXRhU3VwcG9ydDogdHJ1ZSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGNhbGxIaWVyYXJjaHk6IHtcbiAgICAgICAgICAgIGR5bmFtaWNSZWdpc3RyYXRpb246IGZhbHNlLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgaW1wbGVtZW50YXRpb246IHVuZGVmaW5lZCxcbiAgICAgICAgICB0eXBlRGVmaW5pdGlvbjogdW5kZWZpbmVkLFxuICAgICAgICAgIGNvbG9yUHJvdmlkZXI6IHVuZGVmaW5lZCxcbiAgICAgICAgICBmb2xkaW5nUmFuZ2U6IHVuZGVmaW5lZCxcbiAgICAgICAgICBzZWxlY3Rpb25SYW5nZTogdW5kZWZpbmVkLFxuICAgICAgICAgIGxpbmtlZEVkaXRpbmdSYW5nZTogdW5kZWZpbmVkLFxuICAgICAgICAgIHNlbWFudGljVG9rZW5zOiB1bmRlZmluZWQsXG4gICAgICAgIH0sXG4gICAgICAgIGdlbmVyYWw6IHtcbiAgICAgICAgICByZWd1bGFyRXhwcmVzc2lvbnM6IHVuZGVmaW5lZCxcbiAgICAgICAgICBtYXJrZG93bjogdW5kZWZpbmVkLFxuICAgICAgICB9LFxuICAgICAgICB3aW5kb3c6IHtcbiAgICAgICAgICB3b3JrRG9uZVByb2dyZXNzOiBmYWxzZSwgLy8gVE9ETzogc3VwcG9ydFxuICAgICAgICAgIHNob3dNZXNzYWdlOiB1bmRlZmluZWQsXG4gICAgICAgICAgc2hvd0RvY3VtZW50OiB7IHN1cHBvcnQ6IHRydWUgfSxcbiAgICAgICAgfSxcbiAgICAgICAgZXhwZXJpbWVudGFsOiB7fSxcbiAgICAgIH0sXG4gICAgfVxuICB9XG5cbiAgLyoqIChPcHRpb25hbCkgRWFybHkgd2lyZS11cCBvZiBsaXN0ZW5lcnMgYmVmb3JlIGluaXRpYWxpemUgbWV0aG9kIGlzIHNlbnQgKi9cbiAgcHJvdGVjdGVkIHByZUluaXRpYWxpemF0aW9uKF9jb25uZWN0aW9uOiBMYW5ndWFnZUNsaWVudENvbm5lY3Rpb24pOiB2b2lkIHt9XG5cbiAgLyoqIChPcHRpb25hbCkgTGF0ZSB3aXJlLXVwIG9mIGxpc3RlbmVycyBhZnRlciBpbml0aWFsaXplIG1ldGhvZCBoYXMgYmVlbiBzZW50ICovXG4gIHByb3RlY3RlZCBwb3N0SW5pdGlhbGl6YXRpb24oX3NlcnZlcjogQWN0aXZlU2VydmVyKTogdm9pZCB7fVxuXG4gIC8qKiAoT3B0aW9uYWwpIERldGVybWluZSB3aGV0aGVyIHRvIHVzZSBpcGMsIHN0ZGlvIG9yIHNvY2tldCB0byBjb25uZWN0IHRvIHRoZSBzZXJ2ZXIgKi9cbiAgcHJvdGVjdGVkIGdldENvbm5lY3Rpb25UeXBlKCk6IENvbm5lY3Rpb25UeXBlIHtcbiAgICByZXR1cm4gdGhpcy5zb2NrZXQgIT0gbnVsbCA/IFwic29ja2V0XCIgOiBcInN0ZGlvXCJcbiAgfVxuXG4gIC8qKiAoT3B0aW9uYWwpIFJldHVybiB0aGUgbmFtZSBvZiB5b3VyIHJvb3QgY29uZmlndXJhdGlvbiBrZXkgKi9cbiAgcHJvdGVjdGVkIGdldFJvb3RDb25maWd1cmF0aW9uS2V5KCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIFwiXCJcbiAgfVxuXG4gIC8qKiAoT3B0aW9uYWwpIFRyYW5zZm9ybSB0aGUgY29uZmlndXJhdGlvbiBvYmplY3QgYmVmb3JlIGl0IGlzIHNlbnQgdG8gdGhlIHNlcnZlciAqL1xuICBwcm90ZWN0ZWQgbWFwQ29uZmlndXJhdGlvbk9iamVjdChjb25maWd1cmF0aW9uOiBhbnkpOiBhbnkge1xuICAgIHJldHVybiBjb25maWd1cmF0aW9uXG4gIH1cblxuICAvLyBIZWxwZXIgbWV0aG9kcyB0aGF0IGFyZSB1c2VmdWwgZm9yIGltcGxlbWVudG9yc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAvKiogR2V0cyBhIExhbmd1YWdlQ2xpZW50Q29ubmVjdGlvbiBmb3IgYSBnaXZlbiBUZXh0RWRpdG9yICovXG4gIHByb3RlY3RlZCBhc3luYyBnZXRDb25uZWN0aW9uRm9yRWRpdG9yKGVkaXRvcjogVGV4dEVkaXRvcik6IFByb21pc2U8TGFuZ3VhZ2VDbGllbnRDb25uZWN0aW9uIHwgbnVsbD4ge1xuICAgIGNvbnN0IHNlcnZlciA9IGF3YWl0IHRoaXMuX3NlcnZlck1hbmFnZXIuZ2V0U2VydmVyKGVkaXRvcilcbiAgICByZXR1cm4gc2VydmVyID8gc2VydmVyLmNvbm5lY3Rpb24gOiBudWxsXG4gIH1cblxuICAvKiogUmVzdGFydCBhbGwgYWN0aXZlIGxhbmd1YWdlIHNlcnZlcnMgZm9yIHRoaXMgbGFuZ3VhZ2UgY2xpZW50IGluIHRoZSB3b3Jrc3BhY2UgKi9cbiAgcHJvdGVjdGVkIGFzeW5jIHJlc3RhcnRBbGxTZXJ2ZXJzKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMuX3NlcnZlck1hbmFnZXIucmVzdGFydEFsbFNlcnZlcnMoKVxuICB9XG5cbiAgLy8gRGVmYXVsdCBpbXBsZW1lbnRhdGlvbiBvZiB0aGUgcmVzdCBvZiB0aGUgQXV0b0xhbmd1YWdlQ2xpZW50XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gIC8qKiBBY3RpdmF0ZSBkb2VzIHZlcnkgbGl0dGxlIGZvciBwZXJmIHJlYXNvbnMgLSBob29rcyBpbiB2aWEgU2VydmVyTWFuYWdlciBmb3IgbGF0ZXIgJ2FjdGl2YXRpb24nICovXG4gIHB1YmxpYyBhY3RpdmF0ZSgpOiB2b2lkIHtcbiAgICB0aGlzLl9kaXNwb3NhYmxlID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKVxuICAgIHRoaXMubmFtZSA9IGAke3RoaXMuZ2V0TGFuZ3VhZ2VOYW1lKCl9ICgke3RoaXMuZ2V0U2VydmVyTmFtZSgpfSlgXG4gICAgdGhpcy5sb2dnZXIgPSB0aGlzLmdldExvZ2dlcigpXG4gICAgdGhpcy5fc2VydmVyTWFuYWdlciA9IG5ldyBTZXJ2ZXJNYW5hZ2VyKFxuICAgICAgKHApID0+IHRoaXMuc3RhcnRTZXJ2ZXIocCksXG4gICAgICB0aGlzLmxvZ2dlcixcbiAgICAgIChlKSA9PiB0aGlzLnNob3VsZFN0YXJ0Rm9yRWRpdG9yKGUpLFxuICAgICAgKGZpbGVwYXRoKSA9PiB0aGlzLmZpbHRlckNoYW5nZVdhdGNoZWRGaWxlcyhmaWxlcGF0aCksXG4gICAgICB0aGlzLnJlcG9ydEJ1c3lXaGlsZSxcbiAgICAgIHRoaXMuZ2V0U2VydmVyTmFtZSgpLFxuICAgICAgKHRleHRFZGl0b3I6IFRleHRFZGl0b3IpID0+IHRoaXMuZGV0ZXJtaW5lUHJvamVjdFBhdGgodGV4dEVkaXRvciksXG4gICAgICB0aGlzLnNodXRkb3duR3JhY2VmdWxseVxuICAgIClcbiAgICB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLnN0YXJ0TGlzdGVuaW5nKClcbiAgICBwcm9jZXNzLm9uKFwiZXhpdFwiLCAoKSA9PiB0aGlzLmV4aXRDbGVhbnVwLmJpbmQodGhpcykpXG4gIH1cblxuICBwcml2YXRlIGV4aXRDbGVhbnVwKCk6IHZvaWQge1xuICAgIHRoaXMuX3NlcnZlck1hbmFnZXIudGVybWluYXRlKClcbiAgfVxuXG4gIC8qKiBEZWFjdGl2YXRlIGRpc3Bvc2VzIHRoZSByZXNvdXJjZXMgd2UncmUgdXNpbmcgKi9cbiAgcHVibGljIGFzeW5jIGRlYWN0aXZhdGUoKTogUHJvbWlzZTxhbnk+IHtcbiAgICB0aGlzLl9pc0RlYWN0aXZhdGluZyA9IHRydWVcbiAgICB0aGlzLl9kaXNwb3NhYmxlLmRpc3Bvc2UoKVxuICAgIHRoaXMuX3NlcnZlck1hbmFnZXIuc3RvcExpc3RlbmluZygpXG4gICAgYXdhaXQgdGhpcy5fc2VydmVyTWFuYWdlci5zdG9wQWxsU2VydmVycygpXG4gIH1cblxuICAvKipcbiAgICogU3Bhd24gYSBnZW5lcmFsIGxhbmd1YWdlIHNlcnZlci4gVXNlIHRoaXMgaW5zaWRlIHRoZSBgc3RhcnRTZXJ2ZXJQcm9jZXNzYCBvdmVycmlkZSBpZiB0aGUgbGFuZ3VhZ2Ugc2VydmVyIGlzIGFcbiAgICogZ2VuZXJhbCBleGVjdXRhYmxlLiBBbHNvIHNlZSB0aGUgYHNwYXduQ2hpbGROb2RlYCBtZXRob2QuIElmIHRoZSBuYW1lIGlzIHByb3ZpZGVkIGFzIHRoZSBmaXJzdCBhcmd1bWVudCwgaXQgY2hlY2tzXG4gICAqIGBiaW4vcGxhdGZvcm0tYXJjaC9leGVOYW1lYCBieSBkZWZhdWx0LCBhbmQgaWYgZG9lc24ndCBleGlzdHMgdXNlcyB0aGUgZXhlIG9uIFBBVEguIEZvciBleGFtcGxlIG9uIFdpbmRvd3MgeDY0LCBieVxuICAgKiBwYXNzaW5nIGBzZXJ2ZS1kYCwgYGJpbi93aW4zMi14NjQvZXhlTmFtZS5leGVgIGlzIHNwYXduZWQgYnkgZGVmYXVsdC5cbiAgICpcbiAgICogQHBhcmFtIGV4ZSBUaGUgYG5hbWVgIG9yIGBwYXRoYCBvZiB0aGUgZXhlY3V0YWJsZVxuICAgKiBAcGFyYW0gYXJncyBBcmdzIHBhc3NlZCB0byBzcGF3biB0aGUgZXhlLiBEZWZhdWx0cyB0byBgW11gLlxuICAgKiBAcGFyYW0gb3B0aW9uczogQ2hpbGQgcHJvY2VzcyBzcGF3biBvcHRpb25zLiBEZWZhdWx0cyB0byBge31gLlxuICAgKiBAcGFyYW0gcm9vdFBhdGggVGhlIHBhdGggb2YgdGhlIGZvbGRlciBvZiB0aGUgZXhlIGZpbGUuIERlZmF1bHRzIHRvIGBqb2luKFwiYmluXCIsIGAke3Byb2Nlc3MucGxhdGZvcm19LSR7cHJvY2Vzcy5hcmNofSBgKWAuXG4gICAqIEBwYXJhbSBleGVFeHRlbnRpb24gVGhlIGV4dGVudGlvbiBvZiB0aGUgZXhlIGZpbGUuIERlZmF1bHRzIHRvIGBwcm9jZXNzLnBsYXRmb3JtID09PSBcIndpbjMyXCIgPyBcIi5leGVcIiA6IFwiXCJgXG4gICAqL1xuICBwcm90ZWN0ZWQgc3Bhd24oXG4gICAgZXhlOiBzdHJpbmcsXG4gICAgYXJnczogc3RyaW5nW10gPSBbXSxcbiAgICBvcHRpb25zOiBjcC5TcGF3bk9wdGlvbnMgPSB7fSxcbiAgICByb290UGF0aCA9IFV0aWxzLnJvb3RQYXRoRGVmYXVsdCxcbiAgICBleGVFeHRlbnRpb24gPSBVdGlscy5leGVFeHRlbnRpb25EZWZhdWx0XG4gICk6IExhbmd1YWdlU2VydmVyUHJvY2VzcyB7XG4gICAgdGhpcy5sb2dnZXIuZGVidWcoYHN0YXJ0aW5nIFwiJHtleGV9ICR7YXJncy5qb2luKFwiIFwiKX1cImApXG4gICAgcmV0dXJuIGNwLnNwYXduKFV0aWxzLmdldEV4ZVBhdGgoZXhlLCByb290UGF0aCwgZXhlRXh0ZW50aW9uKSwgYXJncywgb3B0aW9ucylcbiAgfVxuXG4gIC8qKlxuICAgKiBTcGF3biBhIGxhbmd1YWdlIHNlcnZlciB1c2luZyBBdG9tJ3MgTm9kZWpzIHByb2Nlc3MgVXNlIHRoaXMgaW5zaWRlIHRoZSBgc3RhcnRTZXJ2ZXJQcm9jZXNzYCBvdmVycmlkZSBpZiB0aGVcbiAgICogbGFuZ3VhZ2Ugc2VydmVyIGlzIGEgSmF2YVNjcmlwdCBmaWxlLiBBbHNvIHNlZSB0aGUgYHNwYXduYCBtZXRob2RcbiAgICovXG4gIHByb3RlY3RlZCBzcGF3bkNoaWxkTm9kZShhcmdzOiBzdHJpbmdbXSwgb3B0aW9uczogY3AuU3Bhd25PcHRpb25zID0ge30pOiBMYW5ndWFnZVNlcnZlclByb2Nlc3Mge1xuICAgIHRoaXMubG9nZ2VyLmRlYnVnKGBzdGFydGluZyBjaGlsZCBOb2RlIFwiJHthcmdzLmpvaW4oXCIgXCIpfVwiYClcbiAgICBvcHRpb25zLmVudiA9IG9wdGlvbnMuZW52IHx8IE9iamVjdC5jcmVhdGUocHJvY2Vzcy5lbnYpXG4gICAgaWYgKG9wdGlvbnMuZW52KSB7XG4gICAgICBvcHRpb25zLmVudi5FTEVDVFJPTl9SVU5fQVNfTk9ERSA9IFwiMVwiXG4gICAgICBvcHRpb25zLmVudi5FTEVDVFJPTl9OT19BVFRBQ0hfQ09OU09MRSA9IFwiMVwiXG4gICAgfVxuICAgIHJldHVybiBjcC5zcGF3bihwcm9jZXNzLmV4ZWNQYXRoLCBhcmdzLCBvcHRpb25zKVxuICB9XG5cbiAgLyoqIExTUCBsb2dnaW5nIGlzIG9ubHkgc2V0IGZvciB3YXJuaW5ncyAmIGVycm9ycyBieSBkZWZhdWx0IHVubGVzcyB5b3UgdHVybiBvbiB0aGUgY29yZS5kZWJ1Z0xTUCBzZXR0aW5nICovXG4gIHByb3RlY3RlZCBnZXRMb2dnZXIoKTogTG9nZ2VyIHtcbiAgICBjb25zdCBmaWx0ZXIgPSBhdG9tLmNvbmZpZy5nZXQoXCJjb3JlLmRlYnVnTFNQXCIpXG4gICAgICA/IEZpbHRlcmVkTG9nZ2VyLkRldmVsb3BlckxldmVsRmlsdGVyXG4gICAgICA6IEZpbHRlcmVkTG9nZ2VyLlVzZXJMZXZlbEZpbHRlclxuICAgIHJldHVybiBuZXcgRmlsdGVyZWRMb2dnZXIobmV3IENvbnNvbGVMb2dnZXIodGhpcy5uYW1lKSwgZmlsdGVyKVxuICB9XG5cbiAgLyoqIFN0YXJ0cyB0aGUgc2VydmVyIGJ5IHN0YXJ0aW5nIHRoZSBwcm9jZXNzLCB0aGVuIGluaXRpYWxpemluZyB0aGUgbGFuZ3VhZ2Ugc2VydmVyIGFuZCBzdGFydGluZyBhZGFwdGVycyAqL1xuICBwcml2YXRlIGFzeW5jIHN0YXJ0U2VydmVyKHByb2plY3RQYXRoOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2ZVNlcnZlcj4ge1xuICAgIGNvbnN0IGxzUHJvY2VzcyA9IGF3YWl0IHRoaXMucmVwb3J0QnVzeVdoaWxlKFxuICAgICAgYFN0YXJ0aW5nICR7dGhpcy5nZXRTZXJ2ZXJOYW1lKCl9IGZvciAke3BhdGguYmFzZW5hbWUocHJvamVjdFBhdGgpfWAsXG4gICAgICBhc3luYyAoKSA9PiB0aGlzLnN0YXJ0U2VydmVyUHJvY2Vzcyhwcm9qZWN0UGF0aClcbiAgICApXG4gICAgdGhpcy5jYXB0dXJlU2VydmVyRXJyb3JzKGxzUHJvY2VzcywgcHJvamVjdFBhdGgpXG4gICAgY29uc3QgY29ubmVjdGlvbiA9IG5ldyBMYW5ndWFnZUNsaWVudENvbm5lY3Rpb24odGhpcy5jcmVhdGVScGNDb25uZWN0aW9uKGxzUHJvY2VzcyksIHRoaXMubG9nZ2VyKVxuICAgIHRoaXMucHJlSW5pdGlhbGl6YXRpb24oY29ubmVjdGlvbilcbiAgICBjb25zdCBpbml0aWFsaXplUGFyYW1zID0gdGhpcy5nZXRJbml0aWFsaXplUGFyYW1zKHByb2plY3RQYXRoLCBsc1Byb2Nlc3MpXG4gICAgY29uc3QgaW5pdGlhbGl6YXRpb24gPSBjb25uZWN0aW9uLmluaXRpYWxpemUoaW5pdGlhbGl6ZVBhcmFtcylcbiAgICB0aGlzLnJlcG9ydEJ1c3lXaGlsZShgJHt0aGlzLmdldFNlcnZlck5hbWUoKX0gaW5pdGlhbGl6aW5nIGZvciAke3BhdGguYmFzZW5hbWUocHJvamVjdFBhdGgpfWAsICgpID0+IGluaXRpYWxpemF0aW9uKVxuICAgIGNvbnN0IGluaXRpYWxpemVSZXNwb25zZSA9IGF3YWl0IGluaXRpYWxpemF0aW9uXG4gICAgY29uc3QgbmV3U2VydmVyID0ge1xuICAgICAgcHJvamVjdFBhdGgsXG4gICAgICBwcm9jZXNzOiBsc1Byb2Nlc3MsXG4gICAgICBjb25uZWN0aW9uLFxuICAgICAgY2FwYWJpbGl0aWVzOiBpbml0aWFsaXplUmVzcG9uc2UuY2FwYWJpbGl0aWVzLFxuICAgICAgZGlzcG9zYWJsZTogbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKSxcbiAgICAgIGFkZGl0aW9uYWxQYXRoczogbmV3IFNldDxzdHJpbmc+KCksXG4gICAgfVxuICAgIHRoaXMucG9zdEluaXRpYWxpemF0aW9uKG5ld1NlcnZlcilcbiAgICBjb25uZWN0aW9uLmluaXRpYWxpemVkKClcbiAgICBjb25uZWN0aW9uLm9uKFwiY2xvc2VcIiwgKCkgPT4ge1xuICAgICAgaWYgKCF0aGlzLl9pc0RlYWN0aXZhdGluZykge1xuICAgICAgICB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLnN0b3BTZXJ2ZXIobmV3U2VydmVyKVxuICAgICAgICBpZiAoIXRoaXMuX3NlcnZlck1hbmFnZXIuaGFzU2VydmVyUmVhY2hlZFJlc3RhcnRMaW1pdChuZXdTZXJ2ZXIpKSB7XG4gICAgICAgICAgdGhpcy5sb2dnZXIuZGVidWcoYFJlc3RhcnRpbmcgbGFuZ3VhZ2Ugc2VydmVyIGZvciBwcm9qZWN0ICcke25ld1NlcnZlci5wcm9qZWN0UGF0aH0nYClcbiAgICAgICAgICB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLnN0YXJ0U2VydmVyKHByb2plY3RQYXRoKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oYExhbmd1YWdlIHNlcnZlciBoYXMgZXhjZWVkZWQgYXV0by1yZXN0YXJ0IGxpbWl0IGZvciBwcm9qZWN0ICcke25ld1NlcnZlci5wcm9qZWN0UGF0aH0nYClcbiAgICAgICAgICBhdG9tLm5vdGlmaWNhdGlvbnMuYWRkRXJyb3IoXG4gICAgICAgICAgICBgVGhlICR7dGhpcy5uYW1lfSBsYW5ndWFnZSBzZXJ2ZXIgaGFzIGV4aXRlZCBhbmQgZXhjZWVkZWQgdGhlIHJlc3RhcnQgbGltaXQgZm9yIHByb2plY3QgJyR7bmV3U2VydmVyLnByb2plY3RQYXRofSdgXG4gICAgICAgICAgKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcblxuICAgIGNvbnN0IGNvbmZpZ3VyYXRpb25LZXkgPSB0aGlzLmdldFJvb3RDb25maWd1cmF0aW9uS2V5KClcbiAgICBpZiAoY29uZmlndXJhdGlvbktleSkge1xuICAgICAgbmV3U2VydmVyLmRpc3Bvc2FibGUuYWRkKFxuICAgICAgICBhdG9tLmNvbmZpZy5vYnNlcnZlKGNvbmZpZ3VyYXRpb25LZXksIChjb25maWcpID0+IHtcbiAgICAgICAgICBjb25zdCBtYXBwZWRDb25maWcgPSB0aGlzLm1hcENvbmZpZ3VyYXRpb25PYmplY3QoY29uZmlnIHx8IHt9KVxuICAgICAgICAgIGlmIChtYXBwZWRDb25maWcpIHtcbiAgICAgICAgICAgIGNvbm5lY3Rpb24uZGlkQ2hhbmdlQ29uZmlndXJhdGlvbih7XG4gICAgICAgICAgICAgIHNldHRpbmdzOiBtYXBwZWRDb25maWcsXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgIClcbiAgICB9XG5cbiAgICB0aGlzLnN0YXJ0RXhjbHVzaXZlQWRhcHRlcnMobmV3U2VydmVyKVxuICAgIHJldHVybiBuZXdTZXJ2ZXJcbiAgfVxuXG4gIHByaXZhdGUgY2FwdHVyZVNlcnZlckVycm9ycyhsc1Byb2Nlc3M6IExhbmd1YWdlU2VydmVyUHJvY2VzcywgcHJvamVjdFBhdGg6IHN0cmluZyk6IHZvaWQge1xuICAgIGxzUHJvY2Vzcy5vbihcImVycm9yXCIsIChlcnIpID0+IHRoaXMub25TcGF3bkVycm9yKGVycikpXG4gICAgbHNQcm9jZXNzLm9uKFwiY2xvc2VcIiwgKGNvZGUsIHNpZ25hbCkgPT4gdGhpcy5vblNwYXduQ2xvc2UoY29kZSwgc2lnbmFsKSlcbiAgICBsc1Byb2Nlc3Mub24oXCJkaXNjb25uZWN0XCIsICgpID0+IHRoaXMub25TcGF3bkRpc2Nvbm5lY3QoKSlcbiAgICBsc1Byb2Nlc3Mub24oXCJleGl0XCIsIChjb2RlLCBzaWduYWwpID0+IHRoaXMub25TcGF3bkV4aXQoY29kZSwgc2lnbmFsKSlcbiAgICBsc1Byb2Nlc3Muc3RkZXJyPy5zZXRFbmNvZGluZyhcInV0ZjhcIilcbiAgICBsc1Byb2Nlc3Muc3RkZXJyPy5vbihcImRhdGFcIiwgKGNodW5rOiBCdWZmZXIpID0+IHRoaXMub25TcGF3blN0ZEVyckRhdGEoY2h1bmssIHByb2plY3RQYXRoKSlcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgZnVuY3Rpb24gY2FsbGVkIHdoZW5ldmVyIHRoZSBzcGF3bmVkIHNlcnZlciBgZXJyb3Jgcy4gRXh0ZW5kIChjYWxsIHN1cGVyLm9uU3Bhd25FcnJvcikgb3Igb3ZlcnJpZGUgdGhpcyBpZiB5b3VcbiAgICogbmVlZCBjdXN0b20gZXJyb3IgaGFuZGxpbmdcbiAgICovXG4gIHByb3RlY3RlZCBvblNwYXduRXJyb3IoZXJyOiBFcnJvcik6IHZvaWQge1xuICAgIGF0b20ubm90aWZpY2F0aW9ucy5hZGRFcnJvcihcbiAgICAgIGAke3RoaXMuZ2V0U2VydmVyTmFtZSgpfSBsYW5ndWFnZSBzZXJ2ZXIgZm9yICR7dGhpcy5nZXRMYW5ndWFnZU5hbWUoKX0gdW5hYmxlIHRvIHN0YXJ0YCxcbiAgICAgIHtcbiAgICAgICAgZGlzbWlzc2FibGU6IHRydWUsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBlcnIudG9TdHJpbmcoKSxcbiAgICAgIH1cbiAgICApXG4gIH1cblxuICAvKipcbiAgICogVGhlIGZ1bmN0aW9uIGNhbGxlZCB3aGVuZXZlciB0aGUgc3Bhd25lZCBzZXJ2ZXIgYGNsb3NlYHMuIEV4dGVuZCAoY2FsbCBzdXBlci5vblNwYXduQ2xvc2UpIG9yIG92ZXJyaWRlIHRoaXMgaWYgeW91XG4gICAqIG5lZWQgY3VzdG9tIGNsb3NlIGhhbmRsaW5nXG4gICAqL1xuICBwcm90ZWN0ZWQgb25TcGF3bkNsb3NlKGNvZGU6IG51bWJlciB8IG51bGwsIHNpZ25hbDogTm9kZUpTLlNpZ25hbHMgfCBudWxsKTogdm9pZCB7XG4gICAgaWYgKGNvZGUgIT09IDAgJiYgc2lnbmFsID09PSBudWxsKSB7XG4gICAgICBhdG9tLm5vdGlmaWNhdGlvbnMuYWRkRXJyb3IoXG4gICAgICAgIGAke3RoaXMuZ2V0U2VydmVyTmFtZSgpfSBsYW5ndWFnZSBzZXJ2ZXIgZm9yICR7dGhpcy5nZXRMYW5ndWFnZU5hbWUoKX0gd2FzIGNsb3NlZCB3aXRoIGNvZGU6ICR7Y29kZX0uYFxuICAgICAgKVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgZnVuY3Rpb24gY2FsbGVkIHdoZW5ldmVyIHRoZSBzcGF3bmVkIHNlcnZlciBgZGlzY29ubmVjdGBzLiBFeHRlbmQgKGNhbGwgc3VwZXIub25TcGF3bkRpc2Nvbm5lY3QpIG9yIG92ZXJyaWRlXG4gICAqIHRoaXMgaWYgeW91IG5lZWQgY3VzdG9tIGRpc2Nvbm5lY3QgaGFuZGxpbmdcbiAgICovXG4gIHByb3RlY3RlZCBvblNwYXduRGlzY29ubmVjdCgpOiB2b2lkIHtcbiAgICB0aGlzLmxvZ2dlci5kZWJ1ZyhgJHt0aGlzLmdldFNlcnZlck5hbWUoKX0gbGFuZ3VhZ2Ugc2VydmVyIGZvciAke3RoaXMuZ2V0TGFuZ3VhZ2VOYW1lKCl9IGdvdCBkaXNjb25uZWN0ZWQuYClcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgZnVuY3Rpb24gY2FsbGVkIHdoZW5ldmVyIHRoZSBzcGF3bmVkIHNlcnZlciBgZXhpdGBzLiBFeHRlbmQgKGNhbGwgc3VwZXIub25TcGF3bkV4aXQpIG9yIG92ZXJyaWRlIHRoaXMgaWYgeW91XG4gICAqIG5lZWQgY3VzdG9tIGV4aXQgaGFuZGxpbmdcbiAgICovXG4gIHByb3RlY3RlZCBvblNwYXduRXhpdChjb2RlOiBudW1iZXIgfCBudWxsLCBzaWduYWw6IE5vZGVKUy5TaWduYWxzIHwgbnVsbCk6IHZvaWQge1xuICAgIHRoaXMubG9nZ2VyLmRlYnVnKGBleGl0OiBjb2RlICR7Y29kZX0gc2lnbmFsICR7c2lnbmFsfWApXG4gIH1cblxuICAvKiogKE9wdGlvbmFsKSBGaW5kcyB0aGUgcHJvamVjdCBwYXRoLiBJZiB0aGVyZSBpcyBhIGN1c3RvbSBsb2dpYyBmb3IgZmluZGluZyBwcm9qZWN0cyBvdmVycmlkZSB0aGlzIG1ldGhvZC4gKi9cbiAgcHJvdGVjdGVkIGRldGVybWluZVByb2plY3RQYXRoKHRleHRFZGl0b3I6IFRleHRFZGl0b3IpOiBzdHJpbmcgfCBudWxsIHtcbiAgICBjb25zdCBmaWxlUGF0aCA9IHRleHRFZGl0b3IuZ2V0UGF0aCgpXG4gICAgLy8gVE9ETyBjYW4gZmlsZVBhdGggYmUgbnVsbFxuICAgIGlmIChmaWxlUGF0aCA9PT0gbnVsbCB8fCBmaWxlUGF0aCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gbnVsbFxuICAgIH1cbiAgICBjb25zdCBwcm9qZWN0UGF0aCA9IHRoaXMuX3NlcnZlck1hbmFnZXIuZ2V0Tm9ybWFsaXplZFByb2plY3RQYXRocygpLmZpbmQoKGQpID0+IGZpbGVQYXRoLnN0YXJ0c1dpdGgoZCkpXG4gICAgaWYgKHByb2plY3RQYXRoICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiBwcm9qZWN0UGF0aFxuICAgIH1cblxuICAgIGNvbnN0IHNlcnZlcldpdGhDbGFpbSA9IHRoaXMuX3NlcnZlck1hbmFnZXJcbiAgICAgIC5nZXRBY3RpdmVTZXJ2ZXJzKClcbiAgICAgIC5maW5kKChzZXJ2ZXIpID0+IHNlcnZlci5hZGRpdGlvbmFsUGF0aHM/LmhhcyhwYXRoLmRpcm5hbWUoZmlsZVBhdGgpKSlcbiAgICBpZiAoc2VydmVyV2l0aENsYWltICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiBub3JtYWxpemVQYXRoKHNlcnZlcldpdGhDbGFpbS5wcm9qZWN0UGF0aClcbiAgICB9XG4gICAgcmV0dXJuIG51bGxcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgZnVuY3Rpb24gY2FsbGVkIHdoZW5ldmVyIHRoZSBzcGF3bmVkIHNlcnZlciByZXR1cm5zIGBkYXRhYCBpbiBgc3RkZXJyYCBFeHRlbmQgKGNhbGwgc3VwZXIub25TcGF3blN0ZEVyckRhdGEpIG9yXG4gICAqIG92ZXJyaWRlIHRoaXMgaWYgeW91IG5lZWQgY3VzdG9tIHN0ZGVyciBkYXRhIGhhbmRsaW5nXG4gICAqL1xuICBwcm90ZWN0ZWQgb25TcGF3blN0ZEVyckRhdGEoY2h1bms6IEJ1ZmZlciwgcHJvamVjdFBhdGg6IHN0cmluZyk6IHZvaWQge1xuICAgIGNvbnN0IGVycm9yU3RyaW5nID0gY2h1bmsudG9TdHJpbmcoKVxuICAgIHRoaXMuaGFuZGxlU2VydmVyU3RkZXJyKGVycm9yU3RyaW5nLCBwcm9qZWN0UGF0aClcbiAgICAvLyBLZWVwIHRoZSBsYXN0IDUgbGluZXMgZm9yIHBhY2thZ2VzIHRvIHVzZSBpbiBtZXNzYWdlc1xuICAgIHRoaXMucHJvY2Vzc1N0ZEVyciA9ICh0aGlzLnByb2Nlc3NTdGRFcnIgKyBlcnJvclN0cmluZykuc3BsaXQoXCJcXG5cIikuc2xpY2UoLTUpLmpvaW4oXCJcXG5cIilcbiAgfVxuXG4gIC8qKiBDcmVhdGVzIHRoZSBSUEMgY29ubmVjdGlvbiB3aGljaCBjYW4gYmUgaXBjLCBzb2NrZXQgb3Igc3RkaW8gKi9cbiAgcHJpdmF0ZSBjcmVhdGVScGNDb25uZWN0aW9uKGxzUHJvY2VzczogTGFuZ3VhZ2VTZXJ2ZXJQcm9jZXNzKTogcnBjLk1lc3NhZ2VDb25uZWN0aW9uIHtcbiAgICBsZXQgcmVhZGVyOiBycGMuTWVzc2FnZVJlYWRlclxuICAgIGxldCB3cml0ZXI6IHJwYy5NZXNzYWdlV3JpdGVyXG4gICAgY29uc3QgY29ubmVjdGlvblR5cGUgPSB0aGlzLmdldENvbm5lY3Rpb25UeXBlKClcbiAgICBzd2l0Y2ggKGNvbm5lY3Rpb25UeXBlKSB7XG4gICAgICBjYXNlIFwiaXBjXCI6XG4gICAgICAgIHJlYWRlciA9IG5ldyBycGNOb2RlLklQQ01lc3NhZ2VSZWFkZXIobHNQcm9jZXNzIGFzIGNwLkNoaWxkUHJvY2VzcylcbiAgICAgICAgd3JpdGVyID0gbmV3IHJwY05vZGUuSVBDTWVzc2FnZVdyaXRlcihsc1Byb2Nlc3MgYXMgY3AuQ2hpbGRQcm9jZXNzKVxuICAgICAgICBicmVha1xuICAgICAgY2FzZSBcInNvY2tldFwiOlxuICAgICAgICByZWFkZXIgPSBuZXcgcnBjTm9kZS5Tb2NrZXRNZXNzYWdlUmVhZGVyKHRoaXMuc29ja2V0KVxuICAgICAgICB3cml0ZXIgPSBuZXcgcnBjTm9kZS5Tb2NrZXRNZXNzYWdlV3JpdGVyKHRoaXMuc29ja2V0KVxuICAgICAgICBicmVha1xuICAgICAgY2FzZSBcInN0ZGlvXCI6XG4gICAgICAgIGlmIChsc1Byb2Nlc3Muc3RkaW4gIT09IG51bGwgJiYgbHNQcm9jZXNzLnN0ZG91dCAhPT0gbnVsbCkge1xuICAgICAgICAgIHJlYWRlciA9IG5ldyBycGNOb2RlLlN0cmVhbU1lc3NhZ2VSZWFkZXIobHNQcm9jZXNzLnN0ZG91dClcbiAgICAgICAgICB3cml0ZXIgPSBuZXcgcnBjTm9kZS5TdHJlYW1NZXNzYWdlV3JpdGVyKGxzUHJvY2Vzcy5zdGRpbilcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgICAgIGBUaGUgbGFuZ3VhZ2Ugc2VydmVyIHByb2Nlc3MgZm9yICR7dGhpcy5nZXRMYW5ndWFnZU5hbWUoKX0gZG9lcyBub3QgaGF2ZSBhIHZhbGlkIHN0ZGluIGFuZCBzdGRvdXRgXG4gICAgICAgICAgKVxuICAgICAgICAgIHJldHVybiBVdGlscy5hc3NlcnRVbnJlYWNoYWJsZShcInN0ZGlvXCIgYXMgbmV2ZXIpXG4gICAgICAgIH1cbiAgICAgICAgYnJlYWtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBVdGlscy5hc3NlcnRVbnJlYWNoYWJsZShjb25uZWN0aW9uVHlwZSlcbiAgICB9XG5cbiAgICByZXR1cm4gcnBjLmNyZWF0ZU1lc3NhZ2VDb25uZWN0aW9uKHJlYWRlciwgd3JpdGVyLCB7XG4gICAgICBsb2c6ICguLi5fYXJnczogYW55W10pID0+IHt9LFxuICAgICAgd2FybjogKC4uLl9hcmdzOiBhbnlbXSkgPT4ge30sXG4gICAgICBpbmZvOiAoLi4uX2FyZ3M6IGFueVtdKSA9PiB7fSxcbiAgICAgIGVycm9yOiAoLi4uYXJnczogYW55W10pID0+IHtcbiAgICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYXJncylcbiAgICAgIH0sXG4gICAgfSlcbiAgfVxuXG4gIC8qKiBTdGFydCBhZGFwdGVycyB0aGF0IGFyZSBub3Qgc2hhcmVkIGJldHdlZW4gc2VydmVycyAqL1xuICBwcml2YXRlIHN0YXJ0RXhjbHVzaXZlQWRhcHRlcnMoc2VydmVyOiBBY3RpdmVTZXJ2ZXIpOiB2b2lkIHtcbiAgICBBcHBseUVkaXRBZGFwdGVyLmF0dGFjaChzZXJ2ZXIuY29ubmVjdGlvbilcbiAgICBOb3RpZmljYXRpb25zQWRhcHRlci5hdHRhY2goc2VydmVyLmNvbm5lY3Rpb24sIHRoaXMubmFtZSwgc2VydmVyLnByb2plY3RQYXRoKVxuXG4gICAgaWYgKERvY3VtZW50U3luY0FkYXB0ZXIuY2FuQWRhcHQoc2VydmVyLmNhcGFiaWxpdGllcykpIHtcbiAgICAgIGNvbnN0IGRvY1N5bmNBZGFwdGVyID0gbmV3IERvY3VtZW50U3luY0FkYXB0ZXIoXG4gICAgICAgIHNlcnZlci5jb25uZWN0aW9uLFxuICAgICAgICAoZWRpdG9yKSA9PiB0aGlzLnNob3VsZFN5bmNGb3JFZGl0b3IoZWRpdG9yLCBzZXJ2ZXIucHJvamVjdFBhdGgpLFxuICAgICAgICBzZXJ2ZXIuY2FwYWJpbGl0aWVzLnRleHREb2N1bWVudFN5bmMsXG4gICAgICAgIHRoaXMucmVwb3J0QnVzeVdoaWxlXG4gICAgICApXG4gICAgICBzZXJ2ZXIuZGlzcG9zYWJsZS5hZGQoZG9jU3luY0FkYXB0ZXIpXG4gICAgfVxuXG4gICAgY29uc3QgbGludGVyUHVzaFYyID0gbmV3IExpbnRlclB1c2hWMkFkYXB0ZXIoc2VydmVyLmNvbm5lY3Rpb24pXG4gICAgaWYgKHRoaXMuX2xpbnRlckRlbGVnYXRlICE9IG51bGwpIHtcbiAgICAgIGxpbnRlclB1c2hWMi5hdHRhY2godGhpcy5fbGludGVyRGVsZWdhdGUpXG4gICAgfVxuICAgIHNlcnZlci5kaXNwb3NhYmxlLmFkZChsaW50ZXJQdXNoVjIpXG5cbiAgICBjb25zdCBsb2dnaW5nQ29uc29sZSA9IG5ldyBMb2dnaW5nQ29uc29sZUFkYXB0ZXIoc2VydmVyLmNvbm5lY3Rpb24pXG4gICAgaWYgKHRoaXMuX2NvbnNvbGVEZWxlZ2F0ZSAhPSBudWxsKSB7XG4gICAgICBsb2dnaW5nQ29uc29sZS5hdHRhY2godGhpcy5fY29uc29sZURlbGVnYXRlKHsgaWQ6IHRoaXMubmFtZSwgbmFtZTogdGhpcy5nZXRMYW5ndWFnZU5hbWUoKSB9KSlcbiAgICB9XG4gICAgc2VydmVyLmRpc3Bvc2FibGUuYWRkKGxvZ2dpbmdDb25zb2xlKVxuXG4gICAgbGV0IHNpZ25hdHVyZUhlbHBBZGFwdGVyOiBTaWduYXR1cmVIZWxwQWRhcHRlciB8IHVuZGVmaW5lZFxuICAgIGlmIChTaWduYXR1cmVIZWxwQWRhcHRlci5jYW5BZGFwdChzZXJ2ZXIuY2FwYWJpbGl0aWVzKSkge1xuICAgICAgc2lnbmF0dXJlSGVscEFkYXB0ZXIgPSBuZXcgU2lnbmF0dXJlSGVscEFkYXB0ZXIoc2VydmVyLCB0aGlzLmdldEdyYW1tYXJTY29wZXMoKSlcbiAgICAgIGlmICh0aGlzLl9zaWduYXR1cmVIZWxwUmVnaXN0cnkgIT0gbnVsbCkge1xuICAgICAgICBzaWduYXR1cmVIZWxwQWRhcHRlci5hdHRhY2godGhpcy5fc2lnbmF0dXJlSGVscFJlZ2lzdHJ5KVxuICAgICAgfVxuICAgICAgc2VydmVyLmRpc3Bvc2FibGUuYWRkKHNpZ25hdHVyZUhlbHBBZGFwdGVyKVxuICAgIH1cblxuICAgIHRoaXMuX3NlcnZlckFkYXB0ZXJzLnNldChzZXJ2ZXIsIHtcbiAgICAgIGxpbnRlclB1c2hWMixcbiAgICAgIGxvZ2dpbmdDb25zb2xlLFxuICAgICAgc2lnbmF0dXJlSGVscEFkYXB0ZXIsXG4gICAgfSlcblxuICAgIFNob3dEb2N1bWVudEFkYXB0ZXIuYXR0YWNoKHNlcnZlci5jb25uZWN0aW9uKVxuXG4gICAgc2VydmVyLmNvbm5lY3Rpb24ub25Xb3Jrc3BhY2VGb2xkZXJzKCgpID0+IHRoaXMuX3NlcnZlck1hbmFnZXIuZ2V0V29ya3NwYWNlRm9sZGVycygpKVxuICB9XG5cbiAgcHVibGljIHNob3VsZFN5bmNGb3JFZGl0b3IoZWRpdG9yOiBUZXh0RWRpdG9yLCBwcm9qZWN0UGF0aDogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuaXNGaWxlSW5Qcm9qZWN0KGVkaXRvciwgcHJvamVjdFBhdGgpICYmIHRoaXMuc2hvdWxkU3RhcnRGb3JFZGl0b3IoZWRpdG9yKVxuICB9XG5cbiAgcHJvdGVjdGVkIGlzRmlsZUluUHJvamVjdChlZGl0b3I6IFRleHRFZGl0b3IsIHByb2plY3RQYXRoOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICByZXR1cm4gKGVkaXRvci5nZXRQYXRoKCkgfHwgXCJcIikuc3RhcnRzV2l0aChwcm9qZWN0UGF0aClcbiAgfVxuXG4gIC8vIEF1dG9jb21wbGV0ZSsgdmlhIExTIGNvbXBsZXRpb24tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAvKipcbiAgICogQSBtZXRob2QgdG8gb3ZlcnJpZGUgdG8gcmV0dXJuIGFuIGFycmF5IG9mIGdyYW1tYXIgc2NvcGVzIHRoYXQgc2hvdWxkIG5vdCBiZSB1c2VkIGZvciBhdXRvY29tcGxldGlvbi5cbiAgICpcbiAgICogVXN1YWxseSB0aGF0J3MgdXNlZCBmb3IgZGlzYWJsaW5nIGF1dG9jb21wbGV0ZSBpbnNpZGUgY29tbWVudHMsXG4gICAqXG4gICAqIEBleGFtcGxlIElmIHRoZSBncmFtbWFyIHNjb3BlcyBhcmUgWyAnLnNvdXJjZS5qcycgXSwgYGdldEF1dG9jb21wbGV0ZURpc2FibGVkU2NvcGVzYCBtYXkgcmV0dXJuIFsgJy5zb3VyY2UuanMgLmNvbW1lbnQnIF0uXG4gICAqL1xuICBwcm90ZWN0ZWQgZ2V0QXV0b2NvbXBsZXRlRGlzYWJsZWRTY29wZXMoKTogQXJyYXk8c3RyaW5nPiB7XG4gICAgcmV0dXJuIFtdXG4gIH1cblxuICBwdWJsaWMgcHJvdmlkZUF1dG9jb21wbGV0ZSgpOiBhYy5BdXRvY29tcGxldGVQcm92aWRlciB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHNlbGVjdG9yOiB0aGlzLmdldEdyYW1tYXJTY29wZXMoKVxuICAgICAgICAubWFwKChnKSA9PiBncmFtbWFyU2NvcGVUb0F1dG9Db21wbGV0ZVNlbGVjdG9yKGcpKVxuICAgICAgICAuam9pbihcIiwgXCIpLFxuICAgICAgZGlzYWJsZUZvclNlbGVjdG9yOiB0aGlzLmdldEF1dG9jb21wbGV0ZURpc2FibGVkU2NvcGVzKClcbiAgICAgICAgLm1hcCgoZykgPT4gZ3JhbW1hclNjb3BlVG9BdXRvQ29tcGxldGVTZWxlY3RvcihnKSlcbiAgICAgICAgLmpvaW4oXCIsIFwiKSxcbiAgICAgIGluY2x1c2lvblByaW9yaXR5OiAxLFxuICAgICAgc3VnZ2VzdGlvblByaW9yaXR5OiAyLFxuICAgICAgZXhjbHVkZUxvd2VyUHJpb3JpdHk6IGZhbHNlLFxuICAgICAgZmlsdGVyU3VnZ2VzdGlvbnM6IHRydWUsXG4gICAgICBnZXRTdWdnZXN0aW9uczogdGhpcy5nZXRTdWdnZXN0aW9ucy5iaW5kKHRoaXMpLFxuICAgICAgb25EaWRJbnNlcnRTdWdnZXN0aW9uOiAoZXZlbnQpID0+IHtcbiAgICAgICAgQXV0b2NvbXBsZXRlQWRhcHRlci5hcHBseUFkZGl0aW9uYWxUZXh0RWRpdHMoZXZlbnQpXG4gICAgICAgIHRoaXMub25EaWRJbnNlcnRTdWdnZXN0aW9uKGV2ZW50KVxuICAgICAgfSxcbiAgICAgIGdldFN1Z2dlc3Rpb25EZXRhaWxzT25TZWxlY3Q6IHRoaXMuZ2V0U3VnZ2VzdGlvbkRldGFpbHNPblNlbGVjdC5iaW5kKHRoaXMpLFxuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBhc3luYyBnZXRTdWdnZXN0aW9ucyhyZXF1ZXN0OiBhYy5TdWdnZXN0aW9uc1JlcXVlc3RlZEV2ZW50KTogUHJvbWlzZTxhYy5BbnlTdWdnZXN0aW9uW10+IHtcbiAgICBjb25zdCBzZXJ2ZXIgPSBhd2FpdCB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLmdldFNlcnZlcihyZXF1ZXN0LmVkaXRvcilcbiAgICBpZiAoc2VydmVyID09IG51bGwgfHwgIUF1dG9jb21wbGV0ZUFkYXB0ZXIuY2FuQWRhcHQoc2VydmVyLmNhcGFiaWxpdGllcykpIHtcbiAgICAgIHJldHVybiBbXVxuICAgIH1cblxuICAgIHRoaXMuYXV0b0NvbXBsZXRlID0gdGhpcy5hdXRvQ29tcGxldGUgfHwgbmV3IEF1dG9jb21wbGV0ZUFkYXB0ZXIoKVxuICAgIHRoaXMuX2xhc3RBdXRvY29tcGxldGVSZXF1ZXN0ID0gcmVxdWVzdFxuICAgIHJldHVybiB0aGlzLmF1dG9Db21wbGV0ZS5nZXRTdWdnZXN0aW9ucyhcbiAgICAgIHNlcnZlcixcbiAgICAgIHJlcXVlc3QsXG4gICAgICB0aGlzLm9uRGlkQ29udmVydEF1dG9jb21wbGV0ZSxcbiAgICAgIGF0b20uY29uZmlnLmdldChcImF1dG9jb21wbGV0ZS1wbHVzLm1pbmltdW1Xb3JkTGVuZ3RoXCIpXG4gICAgKVxuICB9XG5cbiAgcHJvdGVjdGVkIGFzeW5jIGdldFN1Z2dlc3Rpb25EZXRhaWxzT25TZWxlY3Qoc3VnZ2VzdGlvbjogYWMuQW55U3VnZ2VzdGlvbik6IFByb21pc2U8YWMuQW55U3VnZ2VzdGlvbiB8IG51bGw+IHtcbiAgICBjb25zdCByZXF1ZXN0ID0gdGhpcy5fbGFzdEF1dG9jb21wbGV0ZVJlcXVlc3RcbiAgICBpZiAocmVxdWVzdCA9PSBudWxsKSB7XG4gICAgICByZXR1cm4gbnVsbFxuICAgIH1cbiAgICBjb25zdCBzZXJ2ZXIgPSBhd2FpdCB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLmdldFNlcnZlcihyZXF1ZXN0LmVkaXRvcilcbiAgICBpZiAoc2VydmVyID09IG51bGwgfHwgIUF1dG9jb21wbGV0ZUFkYXB0ZXIuY2FuUmVzb2x2ZShzZXJ2ZXIuY2FwYWJpbGl0aWVzKSB8fCB0aGlzLmF1dG9Db21wbGV0ZSA9PSBudWxsKSB7XG4gICAgICByZXR1cm4gbnVsbFxuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmF1dG9Db21wbGV0ZS5jb21wbGV0ZVN1Z2dlc3Rpb24oc2VydmVyLCBzdWdnZXN0aW9uLCByZXF1ZXN0LCB0aGlzLm9uRGlkQ29udmVydEF1dG9jb21wbGV0ZSlcbiAgfVxuXG4gIHByb3RlY3RlZCBvbkRpZENvbnZlcnRBdXRvY29tcGxldGUoXG4gICAgX2NvbXBsZXRpb25JdGVtOiBscy5Db21wbGV0aW9uSXRlbSxcbiAgICBfc3VnZ2VzdGlvbjogYWMuQW55U3VnZ2VzdGlvbixcbiAgICBfcmVxdWVzdDogYWMuU3VnZ2VzdGlvbnNSZXF1ZXN0ZWRFdmVudFxuICApOiB2b2lkIHt9XG5cbiAgcHJvdGVjdGVkIG9uRGlkSW5zZXJ0U3VnZ2VzdGlvbihfYXJnOiBhYy5TdWdnZXN0aW9uSW5zZXJ0ZWRFdmVudCk6IHZvaWQge31cblxuICAvLyBEZWZpbml0aW9ucyB2aWEgTFMgZG9jdW1lbnRIaWdobGlnaHQgYW5kIGdvdG9EZWZpbml0aW9uLS0tLS0tLS0tLS0tXG4gIHB1YmxpYyBwcm92aWRlRGVmaW5pdGlvbnMoKTogYXRvbUlkZS5EZWZpbml0aW9uUHJvdmlkZXIge1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiB0aGlzLm5hbWUsXG4gICAgICBwcmlvcml0eTogMjAsXG4gICAgICBncmFtbWFyU2NvcGVzOiB0aGlzLmdldEdyYW1tYXJTY29wZXMoKSxcbiAgICAgIHdvcmRSZWdFeHA6IG51bGwsIC8vIFRPRE8gcGFzcyBSZWdFeHBcbiAgICAgIGdldERlZmluaXRpb246IHRoaXMuZ2V0RGVmaW5pdGlvbi5iaW5kKHRoaXMpLFxuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBhc3luYyBnZXREZWZpbml0aW9uKGVkaXRvcjogVGV4dEVkaXRvciwgcG9pbnQ6IFBvaW50KTogUHJvbWlzZTxhdG9tSWRlLkRlZmluaXRpb25RdWVyeVJlc3VsdCB8IG51bGw+IHtcbiAgICBjb25zdCBzZXJ2ZXIgPSBhd2FpdCB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLmdldFNlcnZlcihlZGl0b3IpXG4gICAgaWYgKHNlcnZlciA9PSBudWxsIHx8ICFEZWZpbml0aW9uQWRhcHRlci5jYW5BZGFwdChzZXJ2ZXIuY2FwYWJpbGl0aWVzKSkge1xuICAgICAgcmV0dXJuIG51bGxcbiAgICB9XG5cbiAgICB0aGlzLmRlZmluaXRpb25zID0gdGhpcy5kZWZpbml0aW9ucyB8fCBuZXcgRGVmaW5pdGlvbkFkYXB0ZXIoKVxuICAgIGNvbnN0IHF1ZXJ5ID0gYXdhaXQgdGhpcy5kZWZpbml0aW9ucy5nZXREZWZpbml0aW9uKFxuICAgICAgc2VydmVyLmNvbm5lY3Rpb24sXG4gICAgICBzZXJ2ZXIuY2FwYWJpbGl0aWVzLFxuICAgICAgdGhpcy5nZXRMYW5ndWFnZU5hbWUoKSxcbiAgICAgIGVkaXRvcixcbiAgICAgIHBvaW50XG4gICAgKVxuXG4gICAgaWYgKHF1ZXJ5ICE9PSBudWxsICYmIHNlcnZlci5hZGRpdGlvbmFsUGF0aHMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgLy8gcG9wdWxhdGUgYWRkaXRpb25hbFBhdGhzIGJhc2VkIG9uIGRlZmluaXRpb25zXG4gICAgICAvLyBJbmRpY2F0ZXMgdGhhdCB0aGUgbGFuZ3VhZ2Ugc2VydmVyIGNhbiBzdXBwb3J0IExTUCBmdW5jdGlvbmFsaXR5IGZvciBvdXQgb2YgcHJvamVjdCBmaWxlcyBpbmRpY2F0ZWQgYnkgYHRleHREb2N1bWVudC9kZWZpbml0aW9uYCByZXNwb25zZXMuXG4gICAgICBmb3IgKGNvbnN0IGRlZiBvZiBxdWVyeS5kZWZpbml0aW9ucykge1xuICAgICAgICBjb25zaWRlckFkZGl0aW9uYWxQYXRoKHNlcnZlciBhcyBBY3RpdmVTZXJ2ZXIgJiB7IGFkZGl0aW9uYWxQYXRoczogU2V0PHN0cmluZz4gfSwgcGF0aC5kaXJuYW1lKGRlZi5wYXRoKSlcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcXVlcnlcbiAgfVxuXG4gIC8vIE91dGxpbmUgVmlldyB2aWEgTFMgZG9jdW1lbnRTeW1ib2wtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgcHVibGljIHByb3ZpZGVPdXRsaW5lcygpOiBhdG9tSWRlLk91dGxpbmVQcm92aWRlciB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IHRoaXMubmFtZSxcbiAgICAgIGdyYW1tYXJTY29wZXM6IHRoaXMuZ2V0R3JhbW1hclNjb3BlcygpLFxuICAgICAgcHJpb3JpdHk6IDEsXG4gICAgICBnZXRPdXRsaW5lOiB0aGlzLmdldE91dGxpbmUuYmluZCh0aGlzKSxcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgYXN5bmMgZ2V0T3V0bGluZShlZGl0b3I6IFRleHRFZGl0b3IpOiBQcm9taXNlPGF0b21JZGUuT3V0bGluZSB8IG51bGw+IHtcbiAgICBjb25zdCBzZXJ2ZXIgPSBhd2FpdCB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLmdldFNlcnZlcihlZGl0b3IpXG4gICAgaWYgKHNlcnZlciA9PSBudWxsIHx8ICFPdXRsaW5lVmlld0FkYXB0ZXIuY2FuQWRhcHQoc2VydmVyLmNhcGFiaWxpdGllcykpIHtcbiAgICAgIHJldHVybiBudWxsXG4gICAgfVxuXG4gICAgdGhpcy5vdXRsaW5lVmlldyA9IHRoaXMub3V0bGluZVZpZXcgfHwgbmV3IE91dGxpbmVWaWV3QWRhcHRlcigpXG4gICAgcmV0dXJuIHRoaXMub3V0bGluZVZpZXcuZ2V0T3V0bGluZShzZXJ2ZXIuY29ubmVjdGlvbiwgZWRpdG9yKVxuICB9XG5cbiAgLy8gQ2FsbCBIaWVyYXJjaHkgVmlldyB2aWEgTFMgY2FsbEhpZXJhcmNoeS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBwdWJsaWMgcHJvdmlkZUNhbGxIaWVyYXJjaHkoKTogYXRvbUlkZS5DYWxsSGllcmFyY2h5UHJvdmlkZXIge1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiB0aGlzLm5hbWUsXG4gICAgICBncmFtbWFyU2NvcGVzOiB0aGlzLmdldEdyYW1tYXJTY29wZXMoKSxcbiAgICAgIHByaW9yaXR5OiAxLFxuICAgICAgZ2V0SW5jb21pbmdDYWxsSGllcmFyY2h5OiB0aGlzLmdldEluY29taW5nQ2FsbEhpZXJhcmNoeS5iaW5kKHRoaXMpLFxuICAgICAgZ2V0T3V0Z29pbmdDYWxsSGllcmFyY2h5OiB0aGlzLmdldE91dGdvaW5nQ2FsbEhpZXJhcmNoeS5iaW5kKHRoaXMpLFxuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBhc3luYyBnZXRJbmNvbWluZ0NhbGxIaWVyYXJjaHkoXG4gICAgZWRpdG9yOiBUZXh0RWRpdG9yLFxuICAgIHBvaW50OiBQb2ludFxuICApOiBQcm9taXNlPGF0b21JZGUuQ2FsbEhpZXJhcmNoeTxcImluY29taW5nXCI+IHwgbnVsbD4ge1xuICAgIGNvbnN0IHNlcnZlciA9IGF3YWl0IHRoaXMuX3NlcnZlck1hbmFnZXIuZ2V0U2VydmVyKGVkaXRvcilcbiAgICBpZiAoc2VydmVyID09PSBudWxsIHx8ICFDYWxsSGllcmFyY2h5QWRhcHRlci5jYW5BZGFwdChzZXJ2ZXIuY2FwYWJpbGl0aWVzKSkge1xuICAgICAgcmV0dXJuIG51bGxcbiAgICB9XG4gICAgdGhpcy5jYWxsSGllcmFyY2h5ID0gdGhpcy5jYWxsSGllcmFyY2h5ID8/IENhbGxIaWVyYXJjaHlBZGFwdGVyXG4gICAgcmV0dXJuIHRoaXMuY2FsbEhpZXJhcmNoeS5nZXRDYWxsSGllcmFyY2h5KHNlcnZlci5jb25uZWN0aW9uLCBlZGl0b3IsIHBvaW50LCBcImluY29taW5nXCIpXG4gIH1cblxuICBwcm90ZWN0ZWQgYXN5bmMgZ2V0T3V0Z29pbmdDYWxsSGllcmFyY2h5KFxuICAgIGVkaXRvcjogVGV4dEVkaXRvcixcbiAgICBwb2ludDogUG9pbnRcbiAgKTogUHJvbWlzZTxhdG9tSWRlLkNhbGxIaWVyYXJjaHk8XCJvdXRnb2luZ1wiPiB8IG51bGw+IHtcbiAgICBjb25zdCBzZXJ2ZXIgPSBhd2FpdCB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLmdldFNlcnZlcihlZGl0b3IpXG4gICAgaWYgKHNlcnZlciA9PT0gbnVsbCB8fCAhQ2FsbEhpZXJhcmNoeUFkYXB0ZXIuY2FuQWRhcHQoc2VydmVyLmNhcGFiaWxpdGllcykpIHtcbiAgICAgIHJldHVybiBudWxsXG4gICAgfVxuICAgIHRoaXMuY2FsbEhpZXJhcmNoeSA9IHRoaXMuY2FsbEhpZXJhcmNoeSA/PyBDYWxsSGllcmFyY2h5QWRhcHRlclxuICAgIHJldHVybiB0aGlzLmNhbGxIaWVyYXJjaHkuZ2V0Q2FsbEhpZXJhcmNoeShzZXJ2ZXIuY29ubmVjdGlvbiwgZWRpdG9yLCBwb2ludCwgXCJvdXRnb2luZ1wiKVxuICB9XG5cbiAgLy8gTGludGVyIHB1c2ggdjIgQVBJIHZpYSBMUyBwdWJsaXNoRGlhZ25vc3RpY3NcbiAgcHVibGljIGNvbnN1bWVMaW50ZXJWMihyZWdpc3RlckluZGllOiAocGFyYW1zOiB7IG5hbWU6IHN0cmluZyB9KSA9PiBsaW50ZXIuSW5kaWVEZWxlZ2F0ZSk6IHZvaWQge1xuICAgIHRoaXMuX2xpbnRlckRlbGVnYXRlID0gcmVnaXN0ZXJJbmRpZSh7IG5hbWU6IHRoaXMubmFtZSB9KVxuICAgIGlmICh0aGlzLl9saW50ZXJEZWxlZ2F0ZSA9PSBudWxsKSB7XG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICBmb3IgKGNvbnN0IHNlcnZlciBvZiB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLmdldEFjdGl2ZVNlcnZlcnMoKSkge1xuICAgICAgY29uc3QgbGludGVyUHVzaFYyID0gdGhpcy5nZXRTZXJ2ZXJBZGFwdGVyKHNlcnZlciwgXCJsaW50ZXJQdXNoVjJcIilcbiAgICAgIGlmIChsaW50ZXJQdXNoVjIgIT0gbnVsbCkge1xuICAgICAgICBsaW50ZXJQdXNoVjIuYXR0YWNoKHRoaXMuX2xpbnRlckRlbGVnYXRlKVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIEZpbmQgUmVmZXJlbmNlcyB2aWEgTFMgZmluZFJlZmVyZW5jZXMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgcHVibGljIHByb3ZpZGVGaW5kUmVmZXJlbmNlcygpOiBhdG9tSWRlLkZpbmRSZWZlcmVuY2VzUHJvdmlkZXIge1xuICAgIHJldHVybiB7XG4gICAgICBpc0VkaXRvclN1cHBvcnRlZDogKGVkaXRvcjogVGV4dEVkaXRvcikgPT4gdGhpcy5nZXRHcmFtbWFyU2NvcGVzKCkuaW5jbHVkZXMoZWRpdG9yLmdldEdyYW1tYXIoKS5zY29wZU5hbWUpLFxuICAgICAgZmluZFJlZmVyZW5jZXM6IHRoaXMuZ2V0UmVmZXJlbmNlcy5iaW5kKHRoaXMpLFxuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBhc3luYyBnZXRSZWZlcmVuY2VzKGVkaXRvcjogVGV4dEVkaXRvciwgcG9pbnQ6IFBvaW50KTogUHJvbWlzZTxhdG9tSWRlLkZpbmRSZWZlcmVuY2VzUmV0dXJuIHwgbnVsbD4ge1xuICAgIGNvbnN0IHNlcnZlciA9IGF3YWl0IHRoaXMuX3NlcnZlck1hbmFnZXIuZ2V0U2VydmVyKGVkaXRvcilcbiAgICBpZiAoc2VydmVyID09IG51bGwgfHwgIUZpbmRSZWZlcmVuY2VzQWRhcHRlci5jYW5BZGFwdChzZXJ2ZXIuY2FwYWJpbGl0aWVzKSkge1xuICAgICAgcmV0dXJuIG51bGxcbiAgICB9XG5cbiAgICB0aGlzLmZpbmRSZWZlcmVuY2VzID0gdGhpcy5maW5kUmVmZXJlbmNlcyB8fCBuZXcgRmluZFJlZmVyZW5jZXNBZGFwdGVyKClcbiAgICByZXR1cm4gdGhpcy5maW5kUmVmZXJlbmNlcy5nZXRSZWZlcmVuY2VzKHNlcnZlci5jb25uZWN0aW9uLCBlZGl0b3IsIHBvaW50LCBzZXJ2ZXIucHJvamVjdFBhdGgpXG4gIH1cblxuICAvLyBEYXRhdGlwIHZpYSBMUyB0ZXh0RG9jdW1lbnQvaG92ZXItLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIHB1YmxpYyBjb25zdW1lRGF0YXRpcChzZXJ2aWNlOiBhdG9tSWRlLkRhdGF0aXBTZXJ2aWNlKTogdm9pZCB7XG4gICAgdGhpcy5fZGlzcG9zYWJsZS5hZGQoXG4gICAgICBzZXJ2aWNlLmFkZFByb3ZpZGVyKHtcbiAgICAgICAgcHJvdmlkZXJOYW1lOiB0aGlzLm5hbWUsXG4gICAgICAgIHByaW9yaXR5OiAxLFxuICAgICAgICBncmFtbWFyU2NvcGVzOiB0aGlzLmdldEdyYW1tYXJTY29wZXMoKSxcbiAgICAgICAgdmFsaWRGb3JTY29wZTogKHNjb3BlTmFtZTogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0R3JhbW1hclNjb3BlcygpLmluY2x1ZGVzKHNjb3BlTmFtZSlcbiAgICAgICAgfSxcbiAgICAgICAgZGF0YXRpcDogdGhpcy5nZXREYXRhdGlwLmJpbmQodGhpcyksXG4gICAgICB9KVxuICAgIClcbiAgfVxuXG4gIHByb3RlY3RlZCBhc3luYyBnZXREYXRhdGlwKGVkaXRvcjogVGV4dEVkaXRvciwgcG9pbnQ6IFBvaW50KTogUHJvbWlzZTxhdG9tSWRlLkRhdGF0aXAgfCBudWxsPiB7XG4gICAgY29uc3Qgc2VydmVyID0gYXdhaXQgdGhpcy5fc2VydmVyTWFuYWdlci5nZXRTZXJ2ZXIoZWRpdG9yKVxuICAgIGlmIChzZXJ2ZXIgPT0gbnVsbCB8fCAhRGF0YXRpcEFkYXB0ZXIuY2FuQWRhcHQoc2VydmVyLmNhcGFiaWxpdGllcykpIHtcbiAgICAgIHJldHVybiBudWxsXG4gICAgfVxuXG4gICAgdGhpcy5kYXRhdGlwID0gdGhpcy5kYXRhdGlwIHx8IG5ldyBEYXRhdGlwQWRhcHRlcigpXG4gICAgcmV0dXJuIHRoaXMuZGF0YXRpcC5nZXREYXRhdGlwKHNlcnZlci5jb25uZWN0aW9uLCBlZGl0b3IsIHBvaW50KVxuICB9XG5cbiAgLy8gQ29uc29sZSB2aWEgTFMgbG9nZ2luZy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBwdWJsaWMgY29uc3VtZUNvbnNvbGUoY3JlYXRlQ29uc29sZTogYXRvbUlkZS5Db25zb2xlU2VydmljZSk6IERpc3Bvc2FibGUge1xuICAgIHRoaXMuX2NvbnNvbGVEZWxlZ2F0ZSA9IGNyZWF0ZUNvbnNvbGVcblxuICAgIGZvciAoY29uc3Qgc2VydmVyIG9mIHRoaXMuX3NlcnZlck1hbmFnZXIuZ2V0QWN0aXZlU2VydmVycygpKSB7XG4gICAgICBjb25zdCBsb2dnaW5nQ29uc29sZSA9IHRoaXMuZ2V0U2VydmVyQWRhcHRlcihzZXJ2ZXIsIFwibG9nZ2luZ0NvbnNvbGVcIilcbiAgICAgIGlmIChsb2dnaW5nQ29uc29sZSkge1xuICAgICAgICBsb2dnaW5nQ29uc29sZS5hdHRhY2godGhpcy5fY29uc29sZURlbGVnYXRlKHsgaWQ6IHRoaXMubmFtZSwgbmFtZTogdGhpcy5nZXRMYW5ndWFnZU5hbWUoKSB9KSlcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBObyB3YXkgb2YgZGV0YWNoaW5nIGZyb20gY2xpZW50IGNvbm5lY3Rpb25zIHRvZGF5XG4gICAgcmV0dXJuIG5ldyBEaXNwb3NhYmxlKCgpID0+IHt9KVxuICB9XG5cbiAgLy8gQ29kZSBGb3JtYXQgdmlhIExTIGZvcm1hdERvY3VtZW50ICYgZm9ybWF0RG9jdW1lbnRSYW5nZS0tLS0tLS0tLS0tLVxuICBwdWJsaWMgcHJvdmlkZUNvZGVGb3JtYXQoKTogYXRvbUlkZS5SYW5nZUNvZGVGb3JtYXRQcm92aWRlciB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGdyYW1tYXJTY29wZXM6IHRoaXMuZ2V0R3JhbW1hclNjb3BlcygpLFxuICAgICAgcHJpb3JpdHk6IDEsXG4gICAgICBmb3JtYXRDb2RlOiB0aGlzLmdldENvZGVGb3JtYXQuYmluZCh0aGlzKSxcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgYXN5bmMgZ2V0Q29kZUZvcm1hdChlZGl0b3I6IFRleHRFZGl0b3IsIHJhbmdlOiBSYW5nZSk6IFByb21pc2U8YXRvbUlkZS5UZXh0RWRpdFtdPiB7XG4gICAgY29uc3Qgc2VydmVyID0gYXdhaXQgdGhpcy5fc2VydmVyTWFuYWdlci5nZXRTZXJ2ZXIoZWRpdG9yKVxuICAgIGlmIChzZXJ2ZXIgPT0gbnVsbCB8fCAhQ29kZUZvcm1hdEFkYXB0ZXIuY2FuQWRhcHQoc2VydmVyLmNhcGFiaWxpdGllcykpIHtcbiAgICAgIHJldHVybiBbXVxuICAgIH1cblxuICAgIHJldHVybiBDb2RlRm9ybWF0QWRhcHRlci5mb3JtYXQoc2VydmVyLmNvbm5lY3Rpb24sIHNlcnZlci5jYXBhYmlsaXRpZXMsIGVkaXRvciwgcmFuZ2UpXG4gIH1cblxuICBwdWJsaWMgcHJvdmlkZVJhbmdlQ29kZUZvcm1hdCgpOiBhdG9tSWRlLlJhbmdlQ29kZUZvcm1hdFByb3ZpZGVyIHtcbiAgICByZXR1cm4ge1xuICAgICAgZ3JhbW1hclNjb3BlczogdGhpcy5nZXRHcmFtbWFyU2NvcGVzKCksXG4gICAgICBwcmlvcml0eTogMSxcbiAgICAgIGZvcm1hdENvZGU6IHRoaXMuZ2V0UmFuZ2VDb2RlRm9ybWF0LmJpbmQodGhpcyksXG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIGFzeW5jIGdldFJhbmdlQ29kZUZvcm1hdChlZGl0b3I6IFRleHRFZGl0b3IsIHJhbmdlOiBSYW5nZSk6IFByb21pc2U8YXRvbUlkZS5UZXh0RWRpdFtdPiB7XG4gICAgY29uc3Qgc2VydmVyID0gYXdhaXQgdGhpcy5fc2VydmVyTWFuYWdlci5nZXRTZXJ2ZXIoZWRpdG9yKVxuICAgIGlmIChzZXJ2ZXIgPT0gbnVsbCB8fCAhc2VydmVyLmNhcGFiaWxpdGllcy5kb2N1bWVudFJhbmdlRm9ybWF0dGluZ1Byb3ZpZGVyKSB7XG4gICAgICByZXR1cm4gW11cbiAgICB9XG5cbiAgICByZXR1cm4gQ29kZUZvcm1hdEFkYXB0ZXIuZm9ybWF0UmFuZ2Uoc2VydmVyLmNvbm5lY3Rpb24sIGVkaXRvciwgcmFuZ2UpXG4gIH1cblxuICBwdWJsaWMgcHJvdmlkZUZpbGVDb2RlRm9ybWF0KCk6IGF0b21JZGUuRmlsZUNvZGVGb3JtYXRQcm92aWRlciB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGdyYW1tYXJTY29wZXM6IHRoaXMuZ2V0R3JhbW1hclNjb3BlcygpLFxuICAgICAgcHJpb3JpdHk6IDEsXG4gICAgICBmb3JtYXRFbnRpcmVGaWxlOiB0aGlzLmdldEZpbGVDb2RlRm9ybWF0LmJpbmQodGhpcyksXG4gICAgfVxuICB9XG5cbiAgcHVibGljIHByb3ZpZGVPblNhdmVDb2RlRm9ybWF0KCk6IGF0b21JZGUuT25TYXZlQ29kZUZvcm1hdFByb3ZpZGVyIHtcbiAgICByZXR1cm4ge1xuICAgICAgZ3JhbW1hclNjb3BlczogdGhpcy5nZXRHcmFtbWFyU2NvcGVzKCksXG4gICAgICBwcmlvcml0eTogMSxcbiAgICAgIGZvcm1hdE9uU2F2ZTogdGhpcy5nZXRGaWxlQ29kZUZvcm1hdC5iaW5kKHRoaXMpLFxuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBhc3luYyBnZXRGaWxlQ29kZUZvcm1hdChlZGl0b3I6IFRleHRFZGl0b3IpOiBQcm9taXNlPGF0b21JZGUuVGV4dEVkaXRbXT4ge1xuICAgIGNvbnN0IHNlcnZlciA9IGF3YWl0IHRoaXMuX3NlcnZlck1hbmFnZXIuZ2V0U2VydmVyKGVkaXRvcilcbiAgICBpZiAoc2VydmVyID09IG51bGwgfHwgIXNlcnZlci5jYXBhYmlsaXRpZXMuZG9jdW1lbnRGb3JtYXR0aW5nUHJvdmlkZXIpIHtcbiAgICAgIHJldHVybiBbXVxuICAgIH1cblxuICAgIHJldHVybiBDb2RlRm9ybWF0QWRhcHRlci5mb3JtYXREb2N1bWVudChzZXJ2ZXIuY29ubmVjdGlvbiwgZWRpdG9yKVxuICB9XG5cbiAgcHVibGljIHByb3ZpZGVPblR5cGVDb2RlRm9ybWF0KCk6IGF0b21JZGUuT25UeXBlQ29kZUZvcm1hdFByb3ZpZGVyIHtcbiAgICByZXR1cm4ge1xuICAgICAgZ3JhbW1hclNjb3BlczogdGhpcy5nZXRHcmFtbWFyU2NvcGVzKCksXG4gICAgICBwcmlvcml0eTogMSxcbiAgICAgIGZvcm1hdEF0UG9zaXRpb246IHRoaXMuZ2V0T25UeXBlQ29kZUZvcm1hdC5iaW5kKHRoaXMpLFxuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBhc3luYyBnZXRPblR5cGVDb2RlRm9ybWF0KFxuICAgIGVkaXRvcjogVGV4dEVkaXRvcixcbiAgICBwb2ludDogUG9pbnQsXG4gICAgY2hhcmFjdGVyOiBzdHJpbmdcbiAgKTogUHJvbWlzZTxhdG9tSWRlLlRleHRFZGl0W10+IHtcbiAgICBjb25zdCBzZXJ2ZXIgPSBhd2FpdCB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLmdldFNlcnZlcihlZGl0b3IpXG4gICAgaWYgKHNlcnZlciA9PSBudWxsIHx8ICFzZXJ2ZXIuY2FwYWJpbGl0aWVzLmRvY3VtZW50T25UeXBlRm9ybWF0dGluZ1Byb3ZpZGVyKSB7XG4gICAgICByZXR1cm4gW11cbiAgICB9XG5cbiAgICByZXR1cm4gQ29kZUZvcm1hdEFkYXB0ZXIuZm9ybWF0T25UeXBlKHNlcnZlci5jb25uZWN0aW9uLCBlZGl0b3IsIHBvaW50LCBjaGFyYWN0ZXIpXG4gIH1cblxuICBwdWJsaWMgcHJvdmlkZUNvZGVIaWdobGlnaHQoKTogYXRvbUlkZS5Db2RlSGlnaGxpZ2h0UHJvdmlkZXIge1xuICAgIHJldHVybiB7XG4gICAgICBncmFtbWFyU2NvcGVzOiB0aGlzLmdldEdyYW1tYXJTY29wZXMoKSxcbiAgICAgIHByaW9yaXR5OiAxLFxuICAgICAgaGlnaGxpZ2h0OiAoZWRpdG9yLCBwb3NpdGlvbikgPT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRDb2RlSGlnaGxpZ2h0KGVkaXRvciwgcG9zaXRpb24pXG4gICAgICB9LFxuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBhc3luYyBnZXRDb2RlSGlnaGxpZ2h0KGVkaXRvcjogVGV4dEVkaXRvciwgcG9zaXRpb246IFBvaW50KTogUHJvbWlzZTxSYW5nZVtdIHwgbnVsbD4ge1xuICAgIGNvbnN0IHNlcnZlciA9IGF3YWl0IHRoaXMuX3NlcnZlck1hbmFnZXIuZ2V0U2VydmVyKGVkaXRvcilcbiAgICBpZiAoc2VydmVyID09IG51bGwgfHwgIUNvZGVIaWdobGlnaHRBZGFwdGVyLmNhbkFkYXB0KHNlcnZlci5jYXBhYmlsaXRpZXMpKSB7XG4gICAgICByZXR1cm4gbnVsbFxuICAgIH1cblxuICAgIHJldHVybiBDb2RlSGlnaGxpZ2h0QWRhcHRlci5oaWdobGlnaHQoc2VydmVyLmNvbm5lY3Rpb24sIHNlcnZlci5jYXBhYmlsaXRpZXMsIGVkaXRvciwgcG9zaXRpb24pXG4gIH1cblxuICBwdWJsaWMgcHJvdmlkZUNvZGVBY3Rpb25zKCk6IGF0b21JZGUuQ29kZUFjdGlvblByb3ZpZGVyIHtcbiAgICByZXR1cm4ge1xuICAgICAgZ3JhbW1hclNjb3BlczogdGhpcy5nZXRHcmFtbWFyU2NvcGVzKCksXG4gICAgICBwcmlvcml0eTogMSxcbiAgICAgIGdldENvZGVBY3Rpb25zOiAoZWRpdG9yLCByYW5nZSwgZGlhZ25vc3RpY3MpID0+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Q29kZUFjdGlvbnMoZWRpdG9yLCByYW5nZSwgZGlhZ25vc3RpY3MpXG4gICAgICB9LFxuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBhc3luYyBnZXRDb2RlQWN0aW9ucyhcbiAgICBlZGl0b3I6IFRleHRFZGl0b3IsXG4gICAgcmFuZ2U6IFJhbmdlLFxuICAgIGRpYWdub3N0aWNzOiBhdG9tSWRlLkRpYWdub3N0aWNbXVxuICApOiBQcm9taXNlPGF0b21JZGUuQ29kZUFjdGlvbltdIHwgbnVsbD4ge1xuICAgIGNvbnN0IHNlcnZlciA9IGF3YWl0IHRoaXMuX3NlcnZlck1hbmFnZXIuZ2V0U2VydmVyKGVkaXRvcilcbiAgICBpZiAoc2VydmVyID09IG51bGwgfHwgIUNvZGVBY3Rpb25BZGFwdGVyLmNhbkFkYXB0KHNlcnZlci5jYXBhYmlsaXRpZXMpKSB7XG4gICAgICByZXR1cm4gbnVsbFxuICAgIH1cblxuICAgIHJldHVybiBDb2RlQWN0aW9uQWRhcHRlci5nZXRDb2RlQWN0aW9ucyhcbiAgICAgIHNlcnZlci5jb25uZWN0aW9uLFxuICAgICAgc2VydmVyLmNhcGFiaWxpdGllcyxcbiAgICAgIHRoaXMuZ2V0U2VydmVyQWRhcHRlcihzZXJ2ZXIsIFwibGludGVyUHVzaFYyXCIpLFxuICAgICAgZWRpdG9yLFxuICAgICAgcmFuZ2UsXG4gICAgICBkaWFnbm9zdGljcyxcbiAgICAgIHRoaXMuZmlsdGVyQ29kZUFjdGlvbnMuYmluZCh0aGlzKSxcbiAgICAgIHRoaXMub25BcHBseUNvZGVBY3Rpb25zLmJpbmQodGhpcylcbiAgICApXG4gIH1cblxuICAvKiogT3B0aW9uYWxseSBmaWx0ZXIgY29kZSBhY3Rpb24gYmVmb3JlIHRoZXkncmUgZGlzcGxheWVkICovXG4gIHByb3RlY3RlZCBmaWx0ZXJDb2RlQWN0aW9ucyhhY3Rpb25zOiAobHMuQ29tbWFuZCB8IGxzLkNvZGVBY3Rpb24pW10gfCBudWxsKTogKGxzLkNvbW1hbmQgfCBscy5Db2RlQWN0aW9uKVtdIHwgbnVsbCB7XG4gICAgcmV0dXJuIGFjdGlvbnNcbiAgfVxuXG4gIC8qKlxuICAgKiBPcHRpb25hbGx5IGhhbmRsZSBhIGNvZGUgYWN0aW9uIGJlZm9yZSBkZWZhdWx0IGhhbmRsaW5nLiBSZXR1cm4gYGZhbHNlYCB0byBwcmV2ZW50IGRlZmF1bHQgaGFuZGxpbmcsIGB0cnVlYCB0b1xuICAgKiBjb250aW51ZSB3aXRoIGRlZmF1bHQgaGFuZGxpbmcuXG4gICAqL1xuICBwcm90ZWN0ZWQgYXN5bmMgb25BcHBseUNvZGVBY3Rpb25zKF9hY3Rpb246IGxzLkNvbW1hbmQgfCBscy5Db2RlQWN0aW9uKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgcmV0dXJuIHRydWVcbiAgfVxuXG4gIHB1YmxpYyBwcm92aWRlUmVmYWN0b3IoKTogYXRvbUlkZS5SZWZhY3RvclByb3ZpZGVyIHtcbiAgICByZXR1cm4ge1xuICAgICAgZ3JhbW1hclNjb3BlczogdGhpcy5nZXRHcmFtbWFyU2NvcGVzKCksXG4gICAgICBwcmlvcml0eTogMSxcbiAgICAgIHJlbmFtZTogdGhpcy5nZXRSZW5hbWUuYmluZCh0aGlzKSxcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgYXN5bmMgZ2V0UmVuYW1lKFxuICAgIGVkaXRvcjogVGV4dEVkaXRvcixcbiAgICBwb3NpdGlvbjogUG9pbnQsXG4gICAgbmV3TmFtZTogc3RyaW5nXG4gICk6IFByb21pc2U8TWFwPHN0cmluZywgYXRvbUlkZS5UZXh0RWRpdFtdPiB8IG51bGw+IHtcbiAgICBjb25zdCBzZXJ2ZXIgPSBhd2FpdCB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLmdldFNlcnZlcihlZGl0b3IpXG4gICAgaWYgKHNlcnZlciA9PSBudWxsIHx8ICFSZW5hbWVBZGFwdGVyLmNhbkFkYXB0KHNlcnZlci5jYXBhYmlsaXRpZXMpKSB7XG4gICAgICByZXR1cm4gbnVsbFxuICAgIH1cblxuICAgIHJldHVybiBSZW5hbWVBZGFwdGVyLmdldFJlbmFtZShzZXJ2ZXIuY29ubmVjdGlvbiwgZWRpdG9yLCBwb3NpdGlvbiwgbmV3TmFtZSlcbiAgfVxuXG4gIHB1YmxpYyBjb25zdW1lU2lnbmF0dXJlSGVscChyZWdpc3RyeTogYXRvbUlkZS5TaWduYXR1cmVIZWxwUmVnaXN0cnkpOiBEaXNwb3NhYmxlIHtcbiAgICB0aGlzLl9zaWduYXR1cmVIZWxwUmVnaXN0cnkgPSByZWdpc3RyeVxuICAgIGZvciAoY29uc3Qgc2VydmVyIG9mIHRoaXMuX3NlcnZlck1hbmFnZXIuZ2V0QWN0aXZlU2VydmVycygpKSB7XG4gICAgICBjb25zdCBzaWduYXR1cmVIZWxwQWRhcHRlciA9IHRoaXMuZ2V0U2VydmVyQWRhcHRlcihzZXJ2ZXIsIFwic2lnbmF0dXJlSGVscEFkYXB0ZXJcIilcbiAgICAgIGlmIChzaWduYXR1cmVIZWxwQWRhcHRlciAhPSBudWxsKSB7XG4gICAgICAgIHNpZ25hdHVyZUhlbHBBZGFwdGVyLmF0dGFjaChyZWdpc3RyeSlcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG5ldyBEaXNwb3NhYmxlKCgpID0+IHtcbiAgICAgIHRoaXMuX3NpZ25hdHVyZUhlbHBSZWdpc3RyeSA9IHVuZGVmaW5lZFxuICAgIH0pXG4gIH1cblxuICBwdWJsaWMgY29uc3VtZUJ1c3lTaWduYWwoc2VydmljZTogYXRvbUlkZS5CdXN5U2lnbmFsU2VydmljZSk6IERpc3Bvc2FibGUge1xuICAgIHRoaXMuYnVzeVNpZ25hbFNlcnZpY2UgPSBzZXJ2aWNlXG4gICAgcmV0dXJuIG5ldyBEaXNwb3NhYmxlKCgpID0+IGRlbGV0ZSB0aGlzLmJ1c3lTaWduYWxTZXJ2aWNlKVxuICB9XG5cbiAgLyoqXG4gICAqIGBkaWRDaGFuZ2VXYXRjaGVkRmlsZXNgIG1lc3NhZ2UgZmlsdGVyaW5nLCBvdmVycmlkZSBmb3IgY3VzdG9tIGxvZ2ljLlxuICAgKlxuICAgKiBAcGFyYW0gZmlsZVBhdGggUGF0aCBvZiBhIGZpbGUgdGhhdCBoYXMgY2hhbmdlZCBpbiB0aGUgcHJvamVjdCBwYXRoXG4gICAqIEByZXR1cm5zIGBmYWxzZWAgPT4gbWVzc2FnZSB3aWxsIG5vdCBiZSBzZW50IHRvIHRoZSBsYW5ndWFnZSBzZXJ2ZXJcbiAgICovXG4gIHByb3RlY3RlZCBmaWx0ZXJDaGFuZ2VXYXRjaGVkRmlsZXMoX2ZpbGVQYXRoOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdHJ1ZVxuICB9XG5cbiAgLyoqXG4gICAqIElmIHRoaXMgaXMgc2V0IHRvIGB0cnVlYCAodGhlIGRlZmF1bHQgdmFsdWUpLCB0aGUgc2VydmVycyB3aWxsIHNodXQgZG93biBncmFjZWZ1bGx5LiBJZiBpdCBpcyBzZXQgdG8gYGZhbHNlYCwgdGhlXG4gICAqIHNlcnZlcnMgd2lsbCBiZSBraWxsZWQgd2l0aG91dCBhd2FpdGluZyBzaHV0ZG93biByZXNwb25zZS5cbiAgICovXG4gIHByb3RlY3RlZCBzaHV0ZG93bkdyYWNlZnVsbHk6IGJvb2xlYW4gPSB0cnVlXG5cbiAgLyoqXG4gICAqIENhbGxlZCBvbiBsYW5ndWFnZSBzZXJ2ZXIgc3RkZXJyIG91dHB1dC5cbiAgICpcbiAgICogQHBhcmFtIHN0ZGVyciBBIGNodW5rIG9mIHN0ZGVyciBmcm9tIGEgbGFuZ3VhZ2Ugc2VydmVyIGluc3RhbmNlXG4gICAqL1xuICBwcm90ZWN0ZWQgaGFuZGxlU2VydmVyU3RkZXJyKHN0ZGVycjogc3RyaW5nLCBfcHJvamVjdFBhdGg6IHN0cmluZyk6IHZvaWQge1xuICAgIHN0ZGVyclxuICAgICAgLnNwbGl0KFwiXFxuXCIpXG4gICAgICAuZmlsdGVyKChsKSA9PiBsKVxuICAgICAgLmZvckVhY2goKGxpbmUpID0+IHRoaXMubG9nZ2VyLndhcm4oYHN0ZGVyciAke2xpbmV9YCkpXG4gIH1cblxuICBwcml2YXRlIGdldFNlcnZlckFkYXB0ZXI8VCBleHRlbmRzIGtleW9mIFNlcnZlckFkYXB0ZXJzPihcbiAgICBzZXJ2ZXI6IEFjdGl2ZVNlcnZlcixcbiAgICBhZGFwdGVyOiBUXG4gICk6IFNlcnZlckFkYXB0ZXJzW1RdIHwgdW5kZWZpbmVkIHtcbiAgICBjb25zdCBhZGFwdGVycyA9IHRoaXMuX3NlcnZlckFkYXB0ZXJzLmdldChzZXJ2ZXIpXG4gICAgcmV0dXJuIGFkYXB0ZXJzICYmIGFkYXB0ZXJzW2FkYXB0ZXJdXG4gIH1cblxuICBwcm90ZWN0ZWQgcmVwb3J0QnVzeVdoaWxlOiBVdGlscy5SZXBvcnRCdXN5V2hpbGUgPSBhc3luYyAodGl0bGUsIGYpID0+IHtcbiAgICBpZiAodGhpcy5idXN5U2lnbmFsU2VydmljZSkge1xuICAgICAgcmV0dXJuIHRoaXMuYnVzeVNpZ25hbFNlcnZpY2UucmVwb3J0QnVzeVdoaWxlKHRpdGxlLCBmKVxuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5yZXBvcnRCdXN5V2hpbGVEZWZhdWx0KHRpdGxlLCBmKVxuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCByZXBvcnRCdXN5V2hpbGVEZWZhdWx0OiBVdGlscy5SZXBvcnRCdXN5V2hpbGUgPSBhc3luYyAodGl0bGUsIGYpID0+IHtcbiAgICB0aGlzLmxvZ2dlci5pbmZvKGBbU3RhcnRlZF0gJHt0aXRsZX1gKVxuICAgIGxldCByZXNcbiAgICB0cnkge1xuICAgICAgcmVzID0gYXdhaXQgZigpXG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHRoaXMubG9nZ2VyLmluZm8oYFtGaW5pc2hlZF0gJHt0aXRsZX1gKVxuICAgIH1cbiAgICByZXR1cm4gcmVzXG4gIH1cbn1cbiJdfQ==